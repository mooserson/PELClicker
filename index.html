<!-- TODO: 1. ‚úÖ DONE ‚Äî seasonal colors change gradually as you get about 15% away from the next season
 2. ‚úÖ DONE ‚Äî hot streak bonus (hotStreakMult/coldDebuff) now properly resets on prestige
4.  add numbered keyboard for answering questions in quiz mode
 3. change summer poopup to modal rather than browser alert
 5. figure out end game condition and add some kind of "you win" celebration
  -->

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PEL Clicker ‚Äî Study & Click!</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700;900&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Nunito', sans-serif;
      background: linear-gradient(135deg, #0c1821 0%, #162447 50%, #1f4068 100%);
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
      transition: background 0.5s ease;
      padding-bottom: 130px;
    }


    /* === HEADER === */
    header {
      text-align: center;
      padding: 18px 10px 8px;
      position: relative;
      z-index: 1;
    }

    header h1 {
      font-family: 'Fredoka One', cursive;
      font-size: 2.5em;
      background: linear-gradient(90deg, #4ecdc4, #44b09e, #4ecdc4);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 3s linear infinite;
    }

    @keyframes shimmer {
      to {
        background-position: 200% center;
      }
    }

    header .subtitle {
      font-size: 0.95em;
      color: #8da9c4;
      margin-top: 2px;
    }

    .year-badge {
      font-family: 'Fredoka One', cursive;
      font-size: 1.05em;
      color: #f6d365;
      margin-top: 4px;
      letter-spacing: 0.5px;
    }

    .stats-bar {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 8px;
      font-size: 0.85em;
      color: #8da9c4;
    }

    .stats-bar span {
      background: rgba(255, 255, 255, 0.06);
      padding: 3px 12px;
      border-radius: 12px;
    }

    .stats-bar .stat-val {
      color: #4ecdc4;
      font-weight: 700;
    }

    /* === LAYOUT === */
    .game-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      padding: 14px 20px 30px;
      max-width: 1300px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    /* === CLICK SECTION === */
    .click-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 0 0 300px;
    }

    .score-display {
      font-family: 'Fredoka One', cursive;
      font-size: 2.2em;
      color: #4ecdc4;
      margin-bottom: 0;
      min-width: 180px;
      text-align: center;
    }

    .score-label {
      font-family: 'Nunito', sans-serif;
      font-size: 0.75em;
      color: #8da9c4;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .per-second {
      font-size: 0.9em;
      color: #8da9c4;
      margin-bottom: 14px;
      padding: 3px 14px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.06);
      transition: background 0.4s, color 0.4s;
    }

    .per-second.hot-pps {
      background: linear-gradient(90deg, #ff0000, #ff7700, #ffff00, #00ff00, #0077ff, #8800ff, #ff0000);
      background-size: 400% 400%;
      animation: rainbowShift 2s linear infinite;
      color: #fff;
      font-weight: 700;
    }

    .per-second.cold-pps {
      background: linear-gradient(90deg, #1a0000, #4a0000, #2a0000, #0a0000);
      background-size: 300% 300%;
      animation: coldShift 3s ease-in-out infinite;
      color: #fc8181;
      font-weight: 700;
    }

    .click-btn {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      border: 5px solid #4ecdc4;
      cursor: pointer;
      background: linear-gradient(135deg, #1a3a5c, #2a5a8c);
      box-shadow: 0 0 35px rgba(78, 205, 196, 0.3), 0 8px 25px rgba(0, 0, 0, 0.4);
      transition: transform 0.08s, box-shadow 0.08s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 3.5em;
      user-select: none;
      -webkit-user-select: none;
      position: relative;
    }

    .click-btn:hover {
      box-shadow: 0 0 50px rgba(78, 205, 196, 0.5), 0 8px 30px rgba(0, 0, 0, 0.5);
    }

    .click-btn:active,
    .click-btn.clicked {
      transform: scale(0.92);
      box-shadow: 0 0 20px rgba(78, 205, 196, 0.2);
    }

    .click-btn.hot-streak {
      background: linear-gradient(135deg, #ff0000, #ff7700, #ffff00, #00ff00, #0077ff, #8800ff, #ff0000);
      background-size: 400% 400%;
      animation: rainbowShift 2s linear infinite;
      border-color: #f6d365;
      box-shadow: 0 0 40px rgba(246, 211, 101, 0.5), 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    @keyframes rainbowShift {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    .click-btn.cold-streak {
      background: linear-gradient(135deg, #1a0000, #4a0000, #2a0000, #0a0000);
      background-size: 300% 300%;
      animation: coldShift 3s ease-in-out infinite;
      border-color: #fc8181;
      box-shadow: 0 0 40px rgba(229, 62, 62, 0.4), 0 8px 25px rgba(0, 0, 0, 0.5);
    }

    @keyframes coldShift {

      0%,
      100% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }
    }

    .click-btn .btn-label {
      font-size: 0.3em;
      font-weight: 700;
      color: #4ecdc4;
      margin-top: 4px;
    }

    .click-power-display {
      margin-top: 10px;
      font-size: 0.85em;
      color: #8da9c4;
      background: rgba(255, 255, 255, 0.06);
      padding: 4px 14px;
      border-radius: 14px;
      transition: background 0.4s, color 0.4s;
    }

    .click-power-display.hot-cpd {
      background: linear-gradient(90deg, #ff0000, #ff7700, #ffff00, #00ff00, #0077ff, #8800ff, #ff0000);
      background-size: 400% 400%;
      animation: rainbowShift 2s linear infinite;
      color: #fff;
      font-weight: 700;
    }

    .click-power-display.cold-cpd {
      background: linear-gradient(90deg, #1a0000, #4a0000, #2a0000, #0a0000);
      background-size: 300% 300%;
      animation: coldShift 3s ease-in-out infinite;
      color: #fc8181;
      font-weight: 700;
    }

    .click-text {
      position: fixed;
      pointer-events: none;
      font-family: 'Fredoka One', cursive;
      font-size: 1.4em;
      color: #4ecdc4;
      animation: floatUp 0.9s ease-out forwards;
      z-index: 100;
    }

    @keyframes floatUp {
      0% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }

      100% {
        opacity: 0;
        transform: translateY(-70px) scale(1.2);
      }
    }

    /* === PRESTIGE === */
    .prestige-mult {
      font-family: 'Fredoka One', cursive;
      font-size: 0.8em;
      color: #f6d365;
      min-height: 18px;
      margin-bottom: 2px;
    }

    .prestige-section {
      text-align: center;
      padding: 10px 20px 14px;
      max-width: 500px;
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      background: rgba(10, 12, 20, 0.85);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 14px 14px 0 0;
      width: 100%;
    }

    .prestige-progress {
      position: relative;
      height: 16px;
      background: rgba(255, 255, 255, 0.06);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 10px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .prestige-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #f6d365, #fda085);
      border-radius: 10px;
      width: 0%;
      transition: width 0.5s;
    }

    .prestige-progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.65em;
      font-weight: 700;
      color: #fff;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.6);
    }

    .prestige-btn {
      background: linear-gradient(135deg, #f6d365, #fda085);
      border: none;
      color: #1a202c;
      font-family: 'Fredoka One', cursive;
      font-size: 1.05em;
      padding: 10px 30px;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 15px rgba(246, 211, 101, 0.3);
    }

    .prestige-btn:hover:not(:disabled) {
      transform: scale(1.05);
      box-shadow: 0 6px 25px rgba(246, 211, 101, 0.5);
    }

    .prestige-btn:disabled {
      opacity: 0.35;
      cursor: not-allowed;
      transform: none;
    }

    .prestige-desc {
      font-size: 0.78em;
      color: #8da9c4;
      margin-top: 6px;
    }

    /* === MASTERY CELEBRATION === */
    .mastery-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 260;
      pointer-events: none;
      text-align: center;
      animation: masteryBoom 1.5s ease-out forwards;
    }

    .mastery-popup .mastery-icon {
      font-size: 4em;
      display: block;
    }

    .mastery-popup .mastery-text {
      font-family: 'Fredoka One', cursive;
      font-size: 1.5em;
      color: #f6d365;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      margin-top: 4px;
    }

    @keyframes masteryBoom {
      0% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(0.5);
      }

      20% {
        transform: translate(-50%, -50%) scale(1.2);
      }

      40% {
        transform: translate(-50%, -50%) scale(1);
      }

      100% {
        opacity: 0;
        transform: translate(-50%, -60%) scale(1.1);
      }
    }

    .mastery-sparkle {
      position: fixed;
      pointer-events: none;
      z-index: 255;
      font-size: 1.5em;
      animation: sparkle 1s ease-out forwards;
    }

    @keyframes sparkle {
      0% {
        opacity: 1;
        transform: scale(0);
      }

      50% {
        opacity: 1;
        transform: scale(1.2);
      }

      100% {
        opacity: 0;
        transform: scale(0.5) translateY(-40px);
      }
    }

    /* === SCREEN FLASH === */
    .screen-flash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 250;
      opacity: 0;
    }

    .screen-flash.red {
      background: radial-gradient(ellipse at center, rgba(229, 62, 62, 0.4) 0%, rgba(229, 62, 62, 0) 70%);
      animation: flashIn 0.6s ease-out forwards;
    }

    .screen-flash.green {
      background: radial-gradient(ellipse at center, rgba(72, 187, 120, 0.35) 0%, rgba(72, 187, 120, 0) 70%);
      animation: flashIn 0.6s ease-out forwards;
    }

    @keyframes flashIn {
      0% {
        opacity: 1;
      }

      100% {
        opacity: 0;
      }
    }

    .quiz-float-number {
      position: fixed;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'Fredoka One', cursive;
      font-size: 3em;
      pointer-events: none;
      z-index: 260;
      text-shadow: 0 2px 12px rgba(0, 0, 0, 0.5);
    }

    .quiz-float-number.penalty {
      color: #fc8181;
      animation: penaltyFloat 1.2s ease-out forwards;
    }

    .quiz-float-number.reward {
      color: #68d391;
      animation: rewardFloat 1.2s ease-out forwards;
    }

    @keyframes penaltyFloat {
      0% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }

      30% {
        transform: translate(-50%, -50%) scale(1.3);
      }

      100% {
        opacity: 0;
        transform: translate(-50%, -100%) scale(0.8);
      }
    }

    @keyframes rewardFloat {
      0% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }

      30% {
        transform: translate(-50%, -50%) scale(1.3);
      }

      100% {
        opacity: 0;
        transform: translate(-50%, -100%) scale(0.8);
      }
    }

    /* === SHOP === */
    .shop-section {
      flex: 1 1 360px;
      max-width: 420px;
      max-height: 45vh;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .section-title {
      font-family: 'Fredoka One', cursive;
      font-size: 1.3em;
      margin-bottom: 10px;
      color: #4ecdc4;
    }

    .shop-item {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 12px 14px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .shop-item:hover:not(.locked) {
      background: rgba(78, 205, 196, 0.08);
      border-color: rgba(78, 205, 196, 0.3);
      transform: translateX(4px);
    }

    .shop-item.locked {
      opacity: 0.35;
      cursor: not-allowed;
    }

    .shop-item .icon {
      font-size: 1.7em;
      width: 38px;
      text-align: center;
      flex-shrink: 0;
    }

    .shop-item .info {
      flex: 1;
    }

    .shop-item .name {
      font-weight: 700;
      font-size: 0.92em;
    }

    .shop-item .desc {
      font-size: 0.76em;
      color: #8da9c4;
    }

    .shop-item .cost {
      font-family: 'Fredoka One', cursive;
      color: #4ecdc4;
      font-size: 0.92em;
      white-space: nowrap;
    }

    .shop-item .owned {
      font-size: 0.72em;
      color: #8da9c4;
    }

    .shop-section::-webkit-scrollbar,
    .achievements-section::-webkit-scrollbar {
      width: 5px;
    }

    .shop-section::-webkit-scrollbar-thumb,
    .achievements-section::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 4px;
    }

    .shop-section::-webkit-scrollbar-track,
    .achievements-section::-webkit-scrollbar-track {
      background: transparent;
    }

    /* === ACHIEVEMENTS === */
    .achievements-section {
      flex: 1 1 320px;
      max-width: 380px;
      max-height: 45vh;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .ach-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .ach-card {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      transition: all 0.3s;
      overflow: hidden;
    }

    .ach-card.locked {
      filter: grayscale(1);
      opacity: 0.3;
    }

    .ach-card.unlocked {
      border-color: rgba(246, 211, 101, 0.4);
      background: rgba(246, 211, 101, 0.06);
    }

    .ach-card.just-unlocked {
      animation: achPop 0.6s ease-out;
    }

    @keyframes achPop {
      0% {
        transform: scale(1);
      }

      30% {
        transform: scale(1.12);
      }

      60% {
        transform: scale(0.96);
      }

      100% {
        transform: scale(1);
      }
    }

    .ach-card .ach-icon {
      font-size: 1.5em;
      margin-bottom: 3px;
    }

    .ach-card .ach-name {
      font-weight: 700;
      font-size: 0.78em;
      line-height: 1.2;
    }

    .ach-card .ach-desc {
      font-size: 0.68em;
      color: #8da9c4;
      margin-top: 2px;
    }

    .ach-card.locked .ach-name {
      color: #555;
    }

    .ach-card.locked .ach-desc {
      color: #444;
    }

    /* === QUIZ MODAL === */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      z-index: 200;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
    }

    .quiz-modal {
      background: linear-gradient(135deg, #1a2a3a, #1f3a5a);
      border: 2px solid rgba(78, 205, 196, 0.3);
      border-radius: 18px;
      padding: 28px;
      max-width: 650px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
      animation: modalIn 0.3s ease-out;
    }

    @keyframes modalIn {
      from {
        transform: scale(0.9) translateY(20px);
        opacity: 0;
      }

      to {
        transform: scale(1) translateY(0);
        opacity: 1;
      }
    }

    .quiz-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .quiz-header .quiz-label {
      font-family: 'Fredoka One', cursive;
      font-size: 1.1em;
      color: #4ecdc4;
    }

    .quiz-header .quiz-cost {
      font-family: 'Fredoka One', cursive;
      color: #f6d365;
    }

    .quiz-question {
      font-size: 1.05em;
      line-height: 1.5;
      margin-bottom: 18px;
      color: #e2e8f0;
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .quiz-option {
      background: rgba(255, 255, 255, 0.06);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 14px 16px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.93em;
      line-height: 1.4;
      text-align: left;
    }

    .quiz-option:hover:not(.disabled) {
      background: rgba(78, 205, 196, 0.1);
      border-color: rgba(78, 205, 196, 0.4);
    }

    .quiz-option.correct {
      background: rgba(72, 187, 120, 0.2);
      border-color: #48bb78;
      color: #c6f6d5;
    }

    .quiz-option.wrong {
      background: rgba(245, 101, 101, 0.2);
      border-color: #f56565;
      color: #fed7d7;
    }

    .quiz-option.disabled {
      cursor: default;
      opacity: 0.7;
    }

    .quiz-option.disabled.correct {
      opacity: 1;
    }

    .quiz-result {
      margin-top: 16px;
      padding: 14px;
      border-radius: 12px;
      font-weight: 700;
      text-align: center;
      font-size: 1em;
      display: none;
    }

    .quiz-result.correct-result {
      display: block;
      background: rgba(72, 187, 120, 0.15);
      border: 1px solid rgba(72, 187, 120, 0.3);
      color: #68d391;
    }

    .quiz-result.wrong-result {
      display: block;
      background: rgba(245, 101, 101, 0.15);
      border: 1px solid rgba(245, 101, 101, 0.3);
      color: #fc8181;
    }

    .quiz-close {
      display: none;
      margin-top: 14px;
      width: 100%;
      background: linear-gradient(135deg, #4ecdc4, #44b09e);
      border: none;
      color: #fff;
      font-family: 'Fredoka One', cursive;
      font-size: 1em;
      padding: 12px;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .quiz-close:hover {
      transform: scale(1.03);
    }

    .quiz-close.show {
      display: block;
    }

    /* === STUDY MODE TRACKER === */
    .study-tracker {
      text-align: center;
      padding: 6px;
      position: relative;
      z-index: 1;
    }

    .study-bar {
      background: rgba(255, 255, 255, 0.06);
      border-radius: 20px;
      height: 18px;
      max-width: 400px;
      margin: 6px auto;
      overflow: hidden;
      position: relative;
    }

    .study-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #4ecdc4, #44b09e);
      border-radius: 20px;
      transition: width 0.5s;
    }

    .study-bar-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.7em;
      font-weight: 700;
      color: #fff;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    /* === TOAST === */
    .toast-container {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 300;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .toast {
      background: linear-gradient(135deg, #2d3748, #1a202c);
      border: 1px solid rgba(78, 205, 196, 0.4);
      border-radius: 12px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      animation: slideIn 0.4s ease-out, fadeOut 0.5s ease-in 3s forwards;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
      max-width: 320px;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      to {
        transform: translateX(100px);
        opacity: 0;
      }
    }

    .toast .toast-icon {
      font-size: 1.4em;
    }

    .toast .toast-text {
      font-size: 0.82em;
    }

    .toast .toast-text strong {
      color: #4ecdc4;
    }

    /* === PARTICLES === */
    #particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes particleDrift {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 0.12;
      }

      100% {
        transform: translateY(-110vh) rotate(360deg);
        opacity: 0;
      }
    }

    /* Burst particles for season transitions */
    @keyframes burstOut {
      0% {
        opacity: 0;
        transform: translate(0, 0) scale(0.5) rotate(0deg);
      }

      15% {
        opacity: 1;
        transform: translate(var(--bx), var(--by)) scale(1.2) rotate(60deg);
      }

      60% {
        opacity: 0.8;
      }

      100% {
        opacity: 0;
        transform: translate(calc(var(--bx) * 2.5), calc(var(--by) * 2.5)) scale(0.3) rotate(360deg);
      }
    }

    .burst-particle {
      position: fixed;
      pointer-events: none;
      z-index: 10000;
      font-size: 28px;
      animation: burstOut ease-out forwards;
    }

    /* === AMBIENT SEASON EFFECTS === */
    .ambient {
      position: fixed;
      pointer-events: none;
      z-index: 0;
    }

    /* Snowflakes */
    .ambient-snow {
      color: #fff;
      font-size: 14px;
      opacity: 0;
      top: -20px;
      animation: snowFall linear forwards;
    }

    @keyframes snowFall {
      0% {
        opacity: 0;
        transform: translateX(0) rotate(0deg);
      }

      5% {
        opacity: 0.7;
      }

      100% {
        opacity: 0;
        transform: translateX(var(--drift)) rotate(360deg);
        top: 105vh;
      }
    }

    /* Leaves */
    .ambient-leaf {
      font-size: 18px;
      opacity: 0;
      top: -20px;
      animation: leafFall linear forwards;
    }

    @keyframes leafFall {
      0% {
        opacity: 0;
        transform: translateX(0) rotate(0deg);
      }

      5% {
        opacity: 0.6;
      }

      50% {
        transform: translateX(var(--drift)) rotate(180deg);
      }

      100% {
        opacity: 0;
        transform: translateX(calc(var(--drift) * -0.5)) rotate(360deg);
        top: 105vh;
      }
    }

    /* Birds */
    .ambient-bird {
      font-size: 16px;
      opacity: 0;
      animation: birdFly linear forwards;
    }

    @keyframes birdFly {
      0% {
        opacity: 0;
        transform: translateX(0) translateY(0);
      }

      10% {
        opacity: 0.6;
      }

      50% {
        transform: translateX(var(--fly-x)) translateY(var(--fly-dip));
      }

      90% {
        opacity: 0.5;
      }

      100% {
        opacity: 0;
        transform: translateX(calc(var(--fly-x) * 2)) translateY(var(--fly-end));
      }
    }

    /* === SEASON BANNER === */
    .season-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      pointer-events: none;
      animation: seasonBannerFade 2.5s ease forwards;
    }

    .season-banner-inner {
      text-align: center;
      transform: scale(0.5);
      animation: seasonBannerPop 2.5s ease forwards;
    }

    .season-banner-emoji {
      font-size: 4em;
      display: block;
      margin-bottom: 8px;
    }

    .season-banner-text {
      font-family: 'Fredoka One', cursive;
      font-size: 2.5em;
      color: #fff;
      text-shadow: 0 0 30px rgba(0, 0, 0, 0.7), 0 0 60px rgba(0, 0, 0, 0.4);
    }

    @keyframes seasonBannerFade {
      0% {
        opacity: 0;
      }

      15% {
        opacity: 1;
      }

      70% {
        opacity: 1;
      }

      100% {
        opacity: 0;
      }
    }

    @keyframes seasonBannerPop {
      0% {
        transform: scale(0.5);
      }

      15% {
        transform: scale(1.1);
      }

      25% {
        transform: scale(1);
      }

      70% {
        transform: scale(1);
      }

      100% {
        transform: scale(0.8);
      }
    }

    /* === TUG-OF-WAR BAR === */
    .tug-wrapper {
      display: flex;
      align-items: center;
      gap: 10px;
      max-width: 1300px;
      margin: 0 auto;
      padding: 0 20px;
      position: relative;
      z-index: 1;
    }

    .tug-end {
      font-size: 2em;
      flex-shrink: 0;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: transform 0.3s, filter 0.3s;
    }

    .tug-end.cold-end.active {
      transform: scale(1.3);
      filter: drop-shadow(0 0 12px #f56565);
    }

    .tug-end.hot-end.active {
      transform: scale(1.3);
      filter: drop-shadow(0 0 12px #f6d365);
    }

    .tug-track {
      flex: 1;
      height: 32px;
      background: rgba(255, 255, 255, 0.06);
      border-radius: 16px;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .tug-fill-cold {
      position: absolute;
      top: 0;
      right: 50%;
      height: 100%;
      background: linear-gradient(90deg, #e53e3e, transparent);
      border-radius: 16px 0 0 16px;
      width: 0%;
      transition: width 0.5s ease-out;
      opacity: 0.5;
    }

    .tug-fill-hot {
      position: absolute;
      top: 0;
      left: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, #48bb78);
      border-radius: 0 16px 16px 0;
      width: 0%;
      transition: width 0.5s ease-out;
      opacity: 0.5;
    }

    .tug-fill-cold.maxed {
      opacity: 0.8;
      animation: coldPulse 1.5s ease-in-out infinite;
    }

    .tug-fill-hot.maxed {
      opacity: 0.8;
      animation: hotPulse 1.5s ease-in-out infinite;
    }

    @keyframes coldPulse {

      0%,
      100% {
        opacity: 0.6;
      }

      50% {
        opacity: 1;
      }
    }

    @keyframes hotPulse {

      0%,
      100% {
        opacity: 0.6;
      }

      50% {
        opacity: 1;
      }
    }

    .tug-center-line {
      position: absolute;
      left: 50%;
      top: 4px;
      bottom: 4px;
      width: 2px;
      background: rgba(255, 255, 255, 0.2);
      transform: translateX(-50%);
      border-radius: 1px;
    }

    .tug-notch {
      position: absolute;
      top: 10px;
      bottom: 10px;
      width: 1px;
      background: rgba(255, 255, 255, 0.08);
    }

    .tug-puck {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #2d3748, #4a5568);
      border: 3px solid rgba(255, 255, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.4);
      transition: left 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      z-index: 2;
    }

    .tug-puck.hot {
      border-color: #f6d365;
      box-shadow: 0 0 20px rgba(246, 211, 101, 0.5), 0 2px 12px rgba(0, 0, 0, 0.4);
      background: linear-gradient(135deg, #744210, #975a16);
    }

    .tug-puck.cold {
      border-color: #fc8181;
      box-shadow: 0 0 20px rgba(252, 129, 129, 0.5), 0 2px 12px rgba(0, 0, 0, 0.4);
      background: linear-gradient(135deg, #742a2a, #9b2c2c);
    }

    .tug-puck-icon {
      font-size: 1.2em;
      transition: transform 0.3s;
    }

    .tug-puck.hot .tug-puck-icon,
    .tug-puck.cold .tug-puck-icon {
      transform: scale(1.2);
    }

    .tug-puck.hidden {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0);
      transition: left 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s, transform 0.3s;
    }

    .tug-status-bar {
      text-align: center;
      font-family: 'Fredoka One', cursive;
      font-size: 0.85em;
      min-height: 22px;
      padding: 2px 0 6px;
      position: relative;
      z-index: 1;
      transition: color 0.3s;
    }

    .tug-status-bar.hot {
      color: #f6d365;
    }

    .tug-status-bar.cold {
      color: #fc8181;
    }

    .tug-status-bar.neutral {
      color: #8da9c4;
    }

    .tug-study-link {
      color: #4ecdc4;
      font-family: 'Nunito', sans-serif;
      font-weight: 700;
      font-size: 0.95em;
      text-decoration: underline;
      margin-left: 8px;
    }

    .tug-study-link:hover {
      color: #fff;
    }

    /* === REVIEW PANEL === */
    .review-btn {
      background: linear-gradient(135deg, #4ecdc4, #44b09e);
      border: none;
      color: #fff;
      font-family: 'Fredoka One', cursive;
      font-size: 0.95em;
      padding: 8px 22px;
      border-radius: 20px;
      cursor: pointer;
      transition: transform 0.2s;
      margin-top: 8px;
    }

    .review-btn:hover {
      transform: scale(1.05);
    }

    .review-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(4px);
      z-index: 200;
      justify-content: center;
      align-items: flex-start;
      padding: 30px 20px;
      overflow-y: auto;
    }

    .review-overlay.active {
      display: flex;
    }

    .review-panel {
      background: linear-gradient(135deg, #1a2a3a, #1f3a5a);
      border: 2px solid rgba(78, 205, 196, 0.3);
      border-radius: 18px;
      padding: 24px;
      max-width: 800px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
      animation: modalIn 0.3s ease-out;
    }

    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .review-header h2 {
      font-family: 'Fredoka One', cursive;
      color: #4ecdc4;
      font-size: 1.3em;
    }

    .review-close-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      font-size: 1.2em;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .review-close-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .review-filters {
      display: flex;
      gap: 8px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }

    .filter-btn {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.15);
      color: #8da9c4;
      font-size: 0.82em;
      padding: 5px 14px;
      border-radius: 16px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.2s;
    }

    .filter-btn:hover {
      border-color: rgba(78, 205, 196, 0.4);
    }

    .filter-btn.active {
      background: rgba(78, 205, 196, 0.15);
      border-color: #4ecdc4;
      color: #4ecdc4;
    }

    .review-card {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 10px;
    }

    .review-card.status-correct {
      border-left: 4px solid #48bb78;
    }

    .review-card.status-wrong {
      border-left: 4px solid #f56565;
    }

    .review-card.status-mastered {
      border-left: 4px solid #f6d365;
    }

    .review-card.status-unseen {
      border-left: 4px solid #4a5568;
    }

    .review-card .rc-question {
      font-size: 0.92em;
      line-height: 1.4;
      margin-bottom: 8px;
      color: #e2e8f0;
    }

    .review-card .rc-answer {
      font-size: 0.84em;
      color: #68d391;
      font-weight: 700;
    }

    .review-card .rc-stats {
      display: flex;
      gap: 12px;
      margin-top: 6px;
      font-size: 0.78em;
      color: #8da9c4;
    }

    .review-card .rc-stats .rc-right {
      color: #68d391;
    }

    .review-card .rc-stats .rc-wrong {
      color: #fc8181;
    }

    .review-card .rc-stats .rc-badge {
      padding: 2px 8px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 0.9em;
    }

    .badge-mastered {
      background: rgba(246, 211, 101, 0.15);
      color: #f6d365;
    }

    .badge-learning {
      background: rgba(78, 205, 196, 0.15);
      color: #4ecdc4;
    }

    .badge-struggling {
      background: rgba(245, 101, 101, 0.15);
      color: #fc8181;
    }

    .badge-unseen {
      background: rgba(255, 255, 255, 0.06);
      color: #4a5568;
    }

    .review-empty {
      text-align: center;
      padding: 30px;
      color: #4a5568;
      font-size: 0.95em;
    }

    /* === RESPONSIVE === */
    @media (max-width: 768px) {
      header h1 {
        font-size: 1.8em;
      }

      .game-container {
        flex-direction: column;
        align-items: center;
        padding: 10px;
      }

      .shop-section,
      .achievements-section {
        max-width: 100%;
      }

      .ach-grid {
        grid-template-columns: 1fr 1fr;
      }

      .quiz-modal {
        padding: 18px;
      }
    }
  </style>
</head>

<body>

  <div id="particles"></div>

  <header>
    <h1>PEL Clicker</h1>
    <div class="year-badge" id="yearBadge">Year 1 ‚Äî üçÇ Fall</div>
    <div class="stats-bar">
      <span>Questions Correct: <span class="stat-val" id="statCorrect">0</span></span>
      <span>Accuracy: <span class="stat-val" id="statAccuracy">--%</span></span>
      <span>Mastered: <span class="stat-val" id="statMastered">0</span>/<span id="statTotal">0</span></span>
    </div>
  </header>

  <div class="study-tracker">
    <div class="study-bar">
      <div class="study-bar-fill" id="studyBarFill" style="width:0%"></div>
      <div class="study-bar-text" id="studyBarText">0% Mastered</div>
    </div>
    <button class="review-btn" id="reviewBtn">Study Review</button>
    <button class="review-btn" id="resetBtn"
      style="background:linear-gradient(135deg,#e53e3e,#c53030);margin-left:8px;">Reset Game</button>
  </div>

  <!-- REVIEW PANEL -->
  <div class="review-overlay" id="reviewOverlay">
    <div class="review-panel">
      <div class="review-header">
        <h2>Study Review</h2>
        <div style="display:flex;align-items:center;gap:10px;">
          <a href="PEL offical Flashcard.pdf" target="_blank"
            style="color:#4ecdc4;font-size:0.8em;font-weight:700;text-decoration:none;">üìÑ Full PDF</a>
          <button class="review-close-btn" id="reviewCloseBtn">&times;</button>
        </div>
      </div>
      <div class="review-filters" id="reviewFilters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="mastered">Mastered</button>
        <button class="filter-btn" data-filter="correct">Getting Right</button>
        <button class="filter-btn" data-filter="wrong">Getting Wrong</button>
        <button class="filter-btn" data-filter="unseen">Not Seen</button>
      </div>
      <div id="reviewList"></div>
    </div>
  </div>

  <!-- TUG-OF-WAR BAR -->
  <div class="tug-wrapper" id="tugWrapper">
    <div class="tug-end cold-end">ü•∂</div>
    <div class="tug-track">
      <div class="tug-fill-cold" id="tugFillCold"></div>
      <div class="tug-fill-hot" id="tugFillHot"></div>
      <div class="tug-center-line"></div>
      <div class="tug-notch" style="left:16.6%"></div>
      <div class="tug-notch" style="left:33.3%"></div>
      <div class="tug-notch" style="left:66.6%"></div>
      <div class="tug-notch" style="left:83.3%"></div>
      <div class="tug-puck" id="tugPuck">
        <span class="tug-puck-icon" id="tugPuckIcon">‚öñÔ∏è</span>
      </div>
    </div>
    <div class="tug-end hot-end">üî•</div>
  </div>
  <div class="tug-status-bar" id="tugStatus"></div>

  <div class="game-container">
    <!-- CLICK AREA -->
    <div class="click-section">
      <div class="score-display" id="score">0</div>
      <div class="score-label">PEL bux</div>
      <div class="prestige-mult" id="prestigeMult"></div>
      <div class="per-second" id="perSecond">0 pts/sec</div>
      <div class="click-btn" id="clickBtn">
        üè´
        <span class="btn-label">CLICK!</span>
      </div>
      <div class="click-power-display" id="clickPower">+1 per click</div>
    </div>

    <!-- SHOP -->
    <div class="shop-section">
      <div class="section-title">Upgrades (Answer to Buy!)</div>
      <div id="shopList"></div>
    </div>

    <!-- ACHIEVEMENTS -->
    <div class="achievements-section">
      <div class="section-title">Achievements <span id="achCount">(0/18)</span></div>
      <div class="ach-grid" id="achGrid"></div>
    </div>
  </div>

  <!-- PRESTIGE -->
  <div class="prestige-section" id="prestigeSection">
    <div class="prestige-progress">
      <div class="prestige-progress-fill" id="prestigeFill"></div>
      <div class="prestige-progress-text" id="prestigeProgressText">0 / 150K ‚Üí Winter ‚ùÑÔ∏è</div>
    </div>
    <button class="prestige-btn" id="prestigeBtn" disabled>
      ‚òÄÔ∏è Summer Vacation
    </button>
    <div class="prestige-desc" id="prestigeDesc">Reach 500K total PEL bux to prestige</div>
    <!-- <div class="prestige-desc" style="margin-top:2px; color:#6b7a8d; font-size:0.72em;">Resets: PEL bux, upgrades, achievements &nbsp;|&nbsp; Keeps: study progress, mastered questions &nbsp;|&nbsp; Gain: permanent multiplier on all earnings</div> -->
  </div>

  <!-- QUIZ MODAL -->
  <div class="modal-overlay" id="quizOverlay">
    <div class="quiz-modal">
      <div class="quiz-header">
        <span class="quiz-label" id="quizLabel">PEL Question</span>
        <span class="quiz-cost" id="quizCost"></span>
      </div>
      <div class="quiz-question" id="quizQuestion"></div>
      <div class="quiz-options" id="quizOptions"></div>
      <div class="quiz-result" id="quizResult"></div>
      <button class="quiz-close" id="quizClose">Continue</button>
    </div>
  </div>

  <div class="toast-container" id="toastContainer"></div>

  <script>
    // ========================================================
    // PEL FLASHCARD DATA ‚Äî extracted directly from the PDF
    // ========================================================
    const flashcards = [
      {
        q: "The school IEP team is having a difficult time with parents who disagree with the decisions being made. The school social worker is asked to talk to the parents about their disagreement. What strategy should the school social worker use with the parents?",
        options: [
          "Mediate/act as an advocate and suggest filing a due process hearing and supporting them during/after",
          "Arrange to meet with the parents in private and listen to them with intention/care",
          "Offer to ask for another re-evaluation from another agency and offer to advocate for the parent during the IEP meeting",
          "Talk to the parent about their rights for an IEP"
        ],
        answer: 1
      },
      {
        q: "A rural school has invited an Alateen to come and share information. How does this best help the school?",
        options: [
          "Understand how alcoholism impacts students",
          "Students learn about substance abuse",
          "Have a community referral for students",
          "Students will learn how to confront their parents' drinking"
        ],
        answer: 2
      },
      {
        q: "According to the IDEA, what is the role of the school social worker?",
        options: [
          "Write SDS and complete behavioral assessments",
          "Advocate for families and students",
          "Read and explain the parent's rights for students with disabilities",
          "Be a liaison between school and family"
        ],
        answer: 0
      },
      {
        q: "A turbulent student:",
        options: [
          "Cares intensely about what others think",
          "Changes hair color often",
          "Joined a different religious group",
          "Does not have appetite and lack of sleep"
        ],
        answer: 3
      },
      {
        q: "Two teachers of a refugee student go to the school social worker to help the student. What could the SSW recommend?",
        options: [
          "Practice English by using flashcards",
          "Change the curriculum as a whole context",
          "More opportunities for cooperative learning",
          "Give students with similar backgrounds together in a class"
        ],
        answer: 2
      },
      {
        q: "A student with SLD has been fighting during recess and in another classroom. What should the IEP team consider doing?",
        options: [
          "Functional Behavior Assessment (FBA)",
          "Behavioral Intervention Plan (BIP)",
          "Adaptive Behavior Assessment",
          "Behavior Rating Scale"
        ],
        answer: 0
      },
      {
        q: "A foster parent came to the school social worker and shared that the biological mother has unscheduled visits, and the student is not completing schoolwork because of this. What intervention would be best to use with the student when completing school assignments?",
        options: [
          "Praising the student when completing schoolwork",
          "Letting the teacher know when grading",
          "Asking foster parent to help",
          "Talking to the biological mom"
        ],
        answer: 0
      },
      {
        q: "What is a challenge for a student who best learns and processes information through auditory learning?",
        options: [
          "Transitioning by hearing a bell or other stimuli",
          "Presenting or reading out loud",
          "Reading on their own",
          "Verbal cues with no visuals"
        ],
        answer: 2
      },
      {
        q: "If a student transfers from a homogenous culture to a diverse school, what will be best for the school social worker to work on with the student?",
        options: [
          "Recognizing differences among cultures",
          "Navigating interactions with a staff of diverse backgrounds",
          "Coping with language barriers in a diverse school setting",
          "Accepting cultural diversity"
        ],
        answer: 0
      },
      {
        q: "A 10th grade student is sexually assaulted and is going to social/emotional groups but reports to the SSW that she still feels hopeless, guilt, and worthless. What intervention will best help the student solve these issues at hand?",
        options: [
          "Writing in a journal and reflecting at home",
          "Having a positive strength by making goals, activities, and more",
          "Making a collage to help her to reflect on herself"
        ],
        answer: 1
      },
      {
        q: "How can the School Social Workers promote parent involvement in the educational environment?",
        options: [
          "Scheduling more conferences",
          "Working with teachers on creating social events",
          "Survey parents on what pressing concerns they have about their child's education",
          "Send newsletters about updates throughout the school"
        ],
        answer: 2
      },
      {
        q: "During the family assessment of parents, what would the school social worker ask the parents?",
        options: [
          "Hobbies and Interests",
          "Employment Status",
          "Medical History",
          "Educational Background"
        ],
        answer: 1
      },
      {
        q: "After multiple assessments, the school social worker believes a student should seek more support from an outside agency. What should the SSW consider first?",
        options: [
          "Ask/Receive written consent from the parents to share information",
          "Make sure parents can pay for the services",
          "Gather pertinent information about the agency to share with the parents",
          "Call the agency to help start services and make them aware"
        ],
        answer: 2
      },
      {
        q: "How can social management be used in a school environment?",
        options: [
          "Develop a crisis plan for all students' problems",
          "See students as full partners and promote them to problem solve their problems",
          "Develop a roster and outline how to address the problems"
        ],
        answer: 1
      },
      {
        q: "How can a school social worker help install more confidence in teachers to address students' needs?",
        options: [
          "Teachers mentoring teachers to provide feedback",
          "Surveying students on how a teacher can best support them",
          "Demonstrating a video on a curriculum and allowing teachers to share feedback",
          "Create a meeting to talk about what they can do"
        ],
        answer: 0
      },
      {
        q: "A School Social Worker would use a Goal Attainment Scale to:",
        options: [
          "Create interventions",
          "Measure/Evaluate the progress of interventions",
          "Assess school performance",
          "Identify outcomes"
        ],
        answer: 1
      },
      {
        q: "How can a school social worker promote safety and health for LGBTQIA+ students?",
        options: [
          "Telling them to build an alliance",
          "Talking to staff about sexual orientation and issues",
          "Start LGBTQ+ support group for students"
        ],
        answer: 1
      },
      {
        q: "Lance is a student with military parents who has been moving due to his parents being restationed and has moved to 4 different schools. Lance has not completed any work including 2 big project assignments. In the first meeting, what is the most appropriate way for the school social worker to address completing assignments?",
        options: [
          "Show Lance the developed plan created by his teacher to help in completing his work",
          "Discuss with Lance why his homework isn't being completed",
          "Ask Lance to come up with a plan with his parents to complete the work",
          "Identify cognitive skills on why he isn't able to complete his work"
        ],
        answer: 1
      },
      {
        q: "A student with divorced parents often demonstrates:",
        options: [
          "Inattentiveness",
          "Hyperactivity",
          "Frustrations",
          "Runs away from home"
        ],
        answer: 0
      },
      {
        q: "A school social worker wants to gather data to understand how many students have health insurance. How can the SSW collect this information?",
        options: [
          "Survey all students in their preferred language",
          "Survey students who go to the school nurse often",
          "Tell students to pick up a copy to take home",
          "Tell the students to pick up a copy at a specific location"
        ],
        answer: 0
      },
      {
        q: "A school social worker conferences the principal to help a teacher with disruptive students. The social worker starts giving possible interventions, and the teacher begins to question if the SSW has ever had classroom experience. The teacher is most likely responding like this because:",
        options: [
          "The principal is present, and the teacher may feel anxious",
          "The teacher needs to be aware of the expertise of the social worker",
          "The teacher is frustrated because they have unsuccessfully defused the children's behavior",
          "The teacher is questioning the school social worker's classroom experience and doubts the support's effectiveness, creating a barrier to communication"
        ],
        answer: 3
      },
      {
        q: "How do school social workers best support teachers?",
        options: [
          "Family Liaison",
          "Group Counseling",
          "Individual Counseling",
          "Direct/Consultation Services"
        ],
        answer: 3
      },
      {
        q: "A teacher shared that a student has carved markings on their arm. What intervention should the school social worker take?",
        options: [
          "Call parents",
          "Call DCFS",
          "Interview the student",
          "Contact the principal"
        ],
        answer: 2
      },
      {
        q: "A student that will struggle to self-report is:",
        options: [
          "A student with internalized behavior, such as anxiety",
          "A student with externalized behavior, such as bullying",
          "A student with a learning disability, such as reading",
          "A student with a social issue, such as truancy"
        ],
        answer: 0
      },
      {
        q: "Teachers ask the school social worker for help in improving parent involvement. What can the SSW do to help?",
        options: [
          "Create a pamphlet on the importance of parent involvement",
          "Inform the teachers to have more parent conferences",
          "Creating a training on parents' involvement",
          "Provide in-service on teaching strategies on parent involvement"
        ],
        answer: 3
      },
      {
        q: "There has been an increase in gang activity in your school. The school social worker should:",
        options: [
          "Create a gang violence victim group activity",
          "Ask to speak with the school administration, police, and other staff",
          "Report it to the news",
          "Ask students what they think would help"
        ],
        answer: 1
      },
      {
        q: "A student using a motorized wheelchair is starting halfway through the school year and the teacher wants to make the student feel welcomed. The school social worker can suggest:",
        options: [
          "Meeting with the student",
          "Meeting with the family",
          "Implement activities to sensitize the other students in the class to the potential challenges the new student may face",
          "Treat the student like a regular student"
        ],
        answer: 2
      },
      {
        q: "A school social worker spends a long time processing a student's report. What should the SSW do?",
        options: [
          "Ask an intern for help",
          "Create software to have scannable answer sheets",
          "Advocate for the testing to have multiple-choice answers or modifications"
        ],
        answer: 1
      },
      {
        q: "A teacher comes to the school social worker for consultation on an issue with another teacher. What should the SSW do?",
        options: [
          "Engage (Ensure) in the conversation on the purpose of consultation",
          "Explain the benefits of the consultation process resolving conflict",
          "Have a meeting between the teachers and act as a mediator",
          "Inform the teacher to talk to the principal"
        ],
        answer: 0
      },
      {
        q: "Several parents call the school social worker about their child's drinking problems. If the parents are seeking guidance, what is the most appropriate thing the SSW should do?",
        options: [
          "Provide resources to the family",
          "Provide a workshop",
          "Interview each child individually to find out more"
        ],
        answer: 2
      },
      {
        q: "A teacher wants to assist a student who has an intellectual disability with their transition to a new school. Which tool can the teacher use to best help facilitate the transition?",
        options: [
          "Behavior Rating Scale",
          "School Records",
          "Cognitive Assessment",
          "A student portfolio"
        ],
        answer: 3
      },
      {
        q: "Head Start has been demonstrated to show successful progress in children because:",
        options: [
          "It helps with social/emotional and other health services",
          "Helps low-income children 3 years to transition to a public school",
          "Helps prepare children from low-income families for school readiness",
          "Supports students who are at risk of academic failure"
        ],
        answer: 2
      },
      {
        q: "Third or fifth grade students are assigned a task comparing their educational experiences with those of their parents', but they are experiencing difficulty completing this task. What explanation best helps explain their dilemma?",
        options: [
          "Sensorimotor",
          "Preoperational ‚Äî students cannot yet write about what they have not experienced",
          "Concrete ‚Äî students cannot yet think abstractly or hypothetically",
          "Formal"
        ],
        answer: 2
      },
      {
        q: "Which of the following statements is true of self-assessment for school social workers?",
        options: [
          "It is only necessary within the context of cross-cultural knowledge and skills",
          "It is only required for licensed professionals during the first three years of practice",
          "SSWs are typically required to complete routine self-assessments to maintain their licensure",
          "SSWs should continually assess their personal strengths and needs to find ways to improve their practice"
        ],
        answer: 3
      },
      {
        q: "What theoretical perspective acknowledges the interaction between nature and nurture in understanding developmental stages?",
        options: [
          "Ecological-biological",
          "Environmental",
          "Biological maturation",
          "Psychodynamic"
        ],
        answer: 0
      },
      {
        q: "A refugee student has recently enrolled in a school, and the team is working to assess the student's needs. What should the team investigate first?",
        options: [
          "Determine the student's English language proficiency and their level of proficiency",
          "Assess the level of education the student has received prior to enrolling in the current school"
        ],
        answer: 1
      },
      {
        q: "After implementing Tier 1 interventions for a student, it is evident that they are not responding positively to the support provided. What should the school social worker do next?",
        options: [
          "Comprehensive evaluation",
          "Refer the student to specialized external services providers",
          "Requesting a meeting with the students' parents to discuss interventions",
          "Finding other strategies to help the student"
        ],
        answer: 3
      },
      {
        q: "Students often visit the nurse during their morning classes complaining of stomachaches. The nurse gives them a nutritious snack and then they go back to class. Why should the school social worker be concerned?",
        options: [
          "Students do not like their teacher",
          "They are not eating breakfast before coming to school",
          "They are bored",
          "They have gastrointestinal issues"
        ],
        answer: 1
      },
      {
        q: "If a school social worker is part of an IEP team, they must meet:",
        options: [
          "Every 6 months",
          "Every Year (Annually)",
          "Every 3 years",
          "Every 10 months"
        ],
        answer: 1
      },
      {
        q: "Students with cultural or socioeconomic backgrounds that are different from the backgrounds of the majority of students at their schools will likely be affected in which of the following ways:",
        options: [
          "They will have a different body of background knowledge than their fellow students which may adversely affect their academic performance",
          "They are more likely than their peers to need special education services",
          "They will be less motivated than their peers because of a lack of parental interest in their academic performance",
          "Their overall academic performance will be reduced because their reading skills will be below grade level"
        ],
        answer: 0
      },
      {
        q: "A teacher reports to the school social worker that middle school students are having a difficult time completing multi-step tasks when instructed by the teacher. What suggestion might the social worker offer?",
        options: [
          "Attending after school detention until their work is caught up",
          "Calling home to ask the parents how the student is functioning at home",
          "Suggesting to the teacher that they break larger tasks into small ones",
          "Assigning to the student a peer mentor"
        ],
        answer: 2
      },
      {
        q: "Within the context of a school, which of the following descriptions commonly apply to systems/organizational theory?",
        options: [
          "A framework that emphasizes federal and state processes",
          "An approach that focuses on district goals and missions",
          "A perspective that promotes positive relationships and alliance between students and teachers"
        ],
        answer: 2
      },
      {
        q: "A school social worker is notified of the sudden death of a student over the weekend. What is the school social worker's initial step?",
        options: [
          "Immediately talk to and mobilize the crisis team for prompt support and assistance in the morning",
          "Open door for students",
          "Create an assembly to let students know"
        ],
        answer: 0
      },
      {
        q: "How can a school social worker demonstrate empathy?",
        options: [
          "Offering condolences and providing support when a student's family member passes away",
          "Telling a student that you understand how they feel"
        ],
        answer: 1
      },
      {
        q: "How does a school social worker maintain current knowledge of their role?",
        options: [
          "Attend webinars or conferences",
          "Read peer-review articles and blogs",
          "Meeting with other school social workers"
        ],
        answer: 0
      },
      {
        q: "Which of the following statements best describes a characteristic of language development in children ages 6 to 11?",
        options: [
          "Can relate words to other words",
          "Formal operational",
          "Repeating new words frequently"
        ],
        answer: 0
      },
      {
        q: "In the self-assessment process, a school social worker should begin by gathering which of the following information?",
        options: [
          "Publications the school social worker has reviewed during the evaluation period",
          "Data related to school social work services provided, time management, and student outcomes",
          "Standards of practice for school social work from national organizations",
          "Review of practice provided by the school social work colleagues within the school district"
        ],
        answer: 1
      },
      {
        q: "A high school is implementing a service-learning project with an outside agency. Which of the following is the most appropriate and effective?",
        options: [
          "Creating a twelve-step program",
          "Volunteering at a domestic violence shelter to help younger children with homework",
          "A football team is collecting money for uniforms",
          "Creating jobs at the agency and allowing students to get hired"
        ],
        answer: 1
      },
      {
        q: "A truant student is only interested in cars, helps in a garage after school, wants to look at car magazines, and dad is unemployed. This theory is:",
        options: [
          "Ecological",
          "Psychodynamic",
          "Developmental",
          "Biological"
        ],
        answer: 0
      },
      {
        q: "Social justice and the NASW state that school social workers are:",
        options: [
          "Mediators",
          "Service Providers",
          "Change Agents",
          "Travel Teachers"
        ],
        answer: 2
      },
      {
        q: "Which shows an error with validity?",
        options: [
          "Norm is significantly different",
          ".08 with a 90 co-efficient",
          "Everyone scores the same"
        ],
        answer: 0
      },
      {
        q: "Community members are included in a needs assessment on the basis of staff members. Which of the following should they recommend?",
        options: [
          "Parents",
          "Agency",
          "The level of experience and expertise (commitment and expertise)",
          "How much they can contribute financially (financial and material)"
        ],
        answer: 2
      },
      {
        q: "There is a change in the consortium team and there has been conflict arising. As the school social worker and leader of the group, you should:",
        options: [
          "Acknowledge that adding new members can be difficult and cause different feelings",
          "Complete a search on peer-review literature on team collaboration and present it in the next meeting",
          "Appoint each member to explain their roles and responsibilities",
          "Talk to each member in person"
        ],
        answer: 0
      },
      {
        q: "A school social worker has gathered a group of students and is currently doing group therapy. It seems that the students are looking at the SSW for guidance. This occurs because:",
        options: [
          "They are in the forming stage",
          "Students are nervous about working with the social worker",
          "Waiting for someone to be the leader",
          "Students are not sure what to talk about"
        ],
        answer: 0
      },
      {
        q: "Using a reframing technique in strengths-based assessment, what question might you ask a student?",
        options: [
          "\"What are you good at?\"",
          "\"Why do you think you respond in that way?\"",
          "\"What are other ways that you could respond to that situation?\""
        ],
        answer: 2
      },
      {
        q: "A student who is socially adjusted to school has been having difficulties in class and has been failing despite her efforts. What should the school social worker and teacher do?",
        options: [
          "Pre-referral team",
          "Refer her to the special education team",
          "Offer Tutoring services",
          "Set her up with a peer mentor"
        ],
        answer: 0
      },
      {
        q: "A school social worker uses informal self-assessments. How can the SSW use these?",
        options: [
          "Build portfolio or resume",
          "Can use for annual reviews/evaluations",
          "Share with the principal accomplishments",
          "Show strengths and growth"
        ],
        answer: 3
      },
      {
        q: "You have several students with disabilities who are graduating high school in a few months. What does your role look like in the transition process?",
        options: [
          "Gathering community resources in one place/document for the professional development library at school",
          "Assisting in finding and linking students to community agencies/jobs",
          "Talk to the special education teacher",
          "Talk to the students"
        ],
        answer: 1
      },
      {
        q: "Which of the following interventions would be most likely to promote within the school staff an understanding of factors that affect the educational environment?",
        options: [
          "Asking teachers to observe an after-school program in which students at risk of academic failure tutor younger students",
          "Giving teachers the address of a website listing social services available in the community",
          "Providing workshops for teachers about the social and cultural barriers to learning",
          "Encouraging teachers to discuss student employment with local businesspeople"
        ],
        answer: 2
      },
      {
        q: "When conducting an SDS to the multidisciplinary team, what is appropriate for the school social worker to share on an IEP for a student?",
        options: [
          "Sharing everything about the student",
          "Sharing teachers report",
          "Summarizing students' academic history",
          "Summarizing environmental factors that affect the student"
        ],
        answer: 3
      },
      {
        q: "A school social worker helps develop questions for a family requesting agency services. What will this help the family with?",
        options: [
          "Help open communication with agency",
          "Have a positive experience",
          "Give full responsibility to the agency about the family's needs",
          "Build trust with wraparound services"
        ],
        answer: 0
      },
      {
        q: "A school social worker is in a leadership position on a committee with new community members. Existing members are getting upset and tense about new members being brought to the board. How can the SSW address this conflict?",
        options: [
          "Provide professional leadership on communication and cooperation",
          "State that we all are here for the same reason and acknowledge that change can be hard",
          "Allow all members to state misgivings about new members"
        ],
        answer: 1
      },
      {
        q: "How can a school social worker efficiently assess 600 students for drug/substance abuse?",
        options: [
          "Send a National confidential survey",
          "Meet with 10 groups of students at a time",
          "Send a survey to parents"
        ],
        answer: 0
      },
      {
        q: "Mr. Pieta is a new teacher who consults with the school social worker to discuss his investment in creating a safe, comfortable learning environment. What suggestions might the school social worker offer first?",
        options: [
          "Involve his class in making the classroom rules",
          "Give students the rules to review",
          "Wait a few weeks and then talk about it",
          "Send home classroom expectations"
        ],
        answer: 0
      },
      {
        q: "A teacher shares with the school social worker that they have suspicions to believe a child is experiencing neglect at home. How can the SSW best support the teacher?",
        options: [
          "Assisting the teacher in completing a mandated report call to child services hotline",
          "Calling home and exploring the information with parents",
          "Talking to the principal about what the teacher shared",
          "Meet with the student to interview them about what the teacher suspects"
        ],
        answer: 0
      },
      {
        q: "Which of the following describes the first steps a school social worker should take before initiating referrals to community agencies for a student's family?",
        options: [
          "Identify the appropriate agency to meet the family's need",
          "Assist the students/parents/guardians as they complete agency's forms",
          "Ensure that the family is financially able to pay agency's fee for services",
          "Assess the effectiveness of the program provided by the agency"
        ],
        answer: 0
      },
      {
        q: "What is the best way for school social workers to help foster the health and well-being of LGBTQ students?",
        options: [
          "Call the students' parents to learn more about the student",
          "Meet with the students to offer support and talk about school resources",
          "Help initiate a gay-straight alliance",
          "Ask the school nurse for help"
        ],
        answer: 1
      },
      {
        q: "The school social worker and principal discuss a needs assessment. What should the SSW do first when discussing the change?",
        options: [
          "Wait for principal to say something to staff and then enforce changes",
          "Request immediate changes over an email",
          "Mentioning at the next staff meeting and asking who would like to participate in the change",
          "Create a pamphlet and distribute it to the staff"
        ],
        answer: 2
      },
      {
        q: "The school social worker meets with a family of a student who is diagnosed with anxiety. How can the SSW support the teacher?",
        options: [
          "Sharing pertinent information about the student",
          "Providing resources to teachers on emotional disorders"
        ],
        answer: 1
      },
      {
        q: "Teachers will be receiving a training by the school social worker on the importance of culture. What should they first start with?",
        options: [
          "Creating a goal for the learning activity",
          "Starting with bias and implicit bias",
          "Identify how to incorporate"
        ],
        answer: 0
      },
      {
        q: "School social worker is having a parent consultation for maladaptive child behaviors. How should the SSW share this with the parent/guardian?",
        options: [
          "Talk about the SSW caring about their child and their success in school",
          "First say you are not the cause",
          "Asking what their expectation of their child is",
          "Say 'We are not blaming you'"
        ],
        answer: 0
      },
      {
        q: "How can a school social worker support services being in a school?",
        options: [
          "Looking over to see how this role will follow the district's goals",
          "Asking the principal what they need",
          "Surveying students about what services they want"
        ],
        answer: 0
      },
      {
        q: "What is something that should be decided at the district level?",
        options: [
          "Hiring and salary",
          "New instruction at various levels",
          "How to meet specific needs of students",
          "Interventions and implementation in a classroom"
        ],
        answer: 0
      },
      {
        q: "A student is referred to a social worker for disruptive behavior. What should the school social worker do next?",
        options: [
          "Do an ADHD assessment",
          "Call home to remind parents of school expectations",
          "Ask parents about what they thought of their child's behavior",
          "Call home to conduct a formal assessment in the home"
        ],
        answer: 2
      },
      {
        q: "School Social Workers use peer-reviewed journals to show effective services and:",
        options: [
          "Induce school staff interventions",
          "To show students and parents how competent you are",
          "Why we use certain interventions"
        ],
        answer: 2
      },
      {
        q: "At the beginning of the school year the SSW gave a training to teachers on ways to handle fights or notice substance use. As the year progresses, what is best to continue helping teachers?",
        options: [
          "Talk to principal to evaluate if they need more trainings",
          "Surveying teachers on how many techniques they have used",
          "Creating a forum for teachers to discuss how they have been using the skills",
          "Providing the same workshops to high school students"
        ],
        answer: 2
      },
      {
        q: "How can parents of an 8-year-old child help establish a positive self-concept?",
        options: [
          "Accepting their strengths and limitations",
          "Offering praise of encouragement",
          "Assigning certain tasks/behaviors on the child",
          "Concrete Rewards"
        ],
        answer: 0
      },
      {
        q: "What does the informal adaptive behaviors assessment identify?",
        options: [
          "Behavior in everyday situations",
          "Self-assessment of his or her behavior",
          "Thought process",
          "Attitude towards job"
        ],
        answer: 1
      },
      {
        q: "Which of the following statements accurately describes the concept of Person-in-Environment (PIE)?",
        options: [
          "PIE refers to someone's thoughts, emotions, behaviors, and environment",
          "PIE focuses on understanding how someone is in the circumstances of their environment",
          "PIE exclusively examines an individual's internal attributes without considering their surroundings",
          "PIE is a term used solely in the context of individual psychology"
        ],
        answer: 1
      },
      {
        q: "General systems theory is best described as:",
        options: [
          "The subsystems operate within a larger system",
          "Each part functions independently",
          "Systems are closed and self-contained"
        ],
        answer: 0
      },
      {
        q: "In therapy, the ecological system helps school social workers by:",
        options: [
          "Identifying one's thoughts, feelings, and behaviors in the environment",
          "Being able to see how one functions in their environment",
          "How their behaviors impact them"
        ],
        answer: 1
      },
      {
        q: "If a school social worker is creating a needs assessment, they should:",
        options: [
          "Review if it has been created before by school personnel/pupil services (create data and close the gap)",
          "See if it aligns with the school administration's manual",
          "See how much it costs"
        ],
        answer: 0
      },
      {
        q: "A school social worker is starting a group therapy session and intends to structure it based on the following:",
        options: [
          "Promote a sense of belonging and connection among group members by sharing similar challenges or conflicts",
          "Let each student talk about whatever they want",
          "Focus on individual assessments first"
        ],
        answer: 0
      },
      {
        q: "What strategies can a school social worker employ to increase parental involvement in schools?",
        options: [
          "Conduct presentations or discussions highlighting the significance of home and school collaboration/communication",
          "Administer surveys to families seeking input on topics related to family conflicts and challenges",
          "Inform parents on new trends and approaches in school settings",
          "Organize workshops or information sessions for parents on relevant topics such as child development or academic support"
        ],
        answer: 0
      },
      {
        q: "What is an adaptive assessment?",
        options: [
          "Age-appropriate assessment that concerns social and educational involvement",
          "A standardized test measuring academic achievement",
          "A cognitive skills evaluation"
        ],
        answer: 0
      },
      {
        q: "A school social worker must follow what ethics in practice?",
        options: [
          "Keeping professional boundaries",
          "Following only school policies",
          "Prioritizing administrative directives"
        ],
        answer: 0
      },
      {
        q: "How can a school social worker help support teachers in professional development?",
        options: [
          "Soliciting input from staff about their professional development needs",
          "Assigning mandatory training sessions",
          "Sending informational emails"
        ],
        answer: 0
      },
      {
        q: "A school social worker receives a student with a different cultural background. What should the SSW do?",
        options: [
          "Explore your own biases and focus on what you have in common. Explore what is appropriate behavior",
          "Let student know that you may not have the same experiences as them",
          "Refer the student to another school social worker who is similar to them"
        ],
        answer: 0
      },
      {
        q: "If a school social worker receives feedback during a job evaluation, they can use this for:",
        options: [
          "Professional Development",
          "Defending their position",
          "Comparing with colleagues"
        ],
        answer: 0
      },
      {
        q: "How can a team best work together?",
        options: [
          "State what their roles are",
          "Understanding how their work and input play a role in others'",
          "Being able to take on someone else's work if they can't do it"
        ],
        answer: 1
      },
      {
        q: "School Social Worker ensures the parents/guardians during the IEP meeting understand scores by explaining:",
        options: [
          "How the scores correlate with educational environment",
          "Scores compared to national scores",
          "Norm referenced"
        ],
        answer: 2
      },
      {
        q: "Reading professional literature can help school social workers function in their practice by:",
        options: [
          "Reflecting on personal experiences/interventions",
          "Remaining updated on current trends and issues in the field",
          "Impressing colleagues with knowledge"
        ],
        answer: 0
      },
      {
        q: "A school social worker is assessing a student with a different cultural background. What can the SSW do to make sure the results are not being biased?",
        options: [
          "SSW observes the student in various locations",
          "Have someone with that same cultural background look over the results",
          "Use a standardized assessment only"
        ],
        answer: 0
      },
      {
        q: "Sixteen-year-old Thomas is a student with behavioral and emotional disabilities. As a related service specified on his IEP, Thomas requires a special education tutor. Which arrangement for providing this service would be least intrusive?",
        options: [
          "Being tutored in the special education non-categorical resource room",
          "Being tutored in the general education classroom",
          "Being tutored at home after school",
          "Being tutored in a separate facility"
        ],
        answer: 0
      },
    ];

    // ========================================================
    // UPGRADES
    // ========================================================
    const upgrades = [
      // Tier 1 ‚Äî Early game
      { id: 'coffee', name: 'Teacher Lounge Coffee', icon: '‚òï', desc: '+1 pts/sec', baseCost: 15, cps: 1 },
      { id: 'clipboard', name: 'Extra Clipboard', icon: 'üìã', desc: '+2 click power', baseCost: 30, clickBonus: 2 },
      // Tier 2 ‚Äî Getting going
      { id: 'crayons', name: 'Art Supplies', icon: 'üñçÔ∏è', desc: '+4 pts/sec', baseCost: 150, cps: 4 },
      { id: 'fidget', name: 'Fidget Tools', icon: 'üåÄ', desc: '+5 click power', baseCost: 300, clickBonus: 5 },
      // Tier 3 ‚Äî Mid game
      { id: 'lunchgroup', name: 'Lunch Group', icon: 'ü™ë', desc: '+12 pts/sec', baseCost: 800, cps: 12 },
      { id: 'calming', name: 'Calming Corner', icon: 'üßò', desc: '+30 pts/sec', baseCost: 2500, cps: 30 },
      { id: 'restorative', name: 'Restorative Circle', icon: 'üîÑ', desc: '+15 click power', baseCost: 3500, clickBonus: 15 },
      // Tier 4 ‚Äî Late-mid
      { id: 'iep_binder', name: 'Paperwork Speedrun', icon: 'üìö', desc: '+75 pts/sec', baseCost: 8000, cps: 75 },
      { id: 'sel_curriculum', name: 'SEL Curriculum', icon: '‚ù§Ô∏è', desc: '+40 click power', baseCost: 12000, clickBonus: 40 },
      // Tier 5 ‚Äî Late game
      { id: 'resource_room', name: 'Resource Room', icon: 'üè†', desc: '+200 pts/sec', baseCost: 30000, cps: 200 },
      { id: 'crisis_kit', name: 'Contract Negotiation Win', icon: 'ü§ù', desc: '+500 pts/sec', baseCost: 80000, cps: 500 },
      { id: 'whole_school', name: 'Whole School MTSS', icon: 'üè´', desc: '+1200 pts/sec', baseCost: 200000, cps: 1200 },
      // Special
      { id: 'streak_boost', name: 'Hot Streak Boost', icon: 'üî•', desc: 'Hot streak multiplier +0.25x', baseCost: 25000, streakBoost: 0.25 },
    ];

    // ========================================================
    // ACHIEVEMENTS
    // ========================================================
    const achievements = [
      { id: 'first_click', name: 'New Intern', icon: 'üëã', desc: 'Click once', check: s => s.totalPts >= 1 },
      { id: 'hundred', name: 'Getting Settled', icon: 'üìé', desc: 'Earn 100 total pts', check: s => s.totalPts >= 100 },
      { id: 'thousand', name: 'Case Manager', icon: '‚≠ê', desc: 'Earn 1,000 total pts', check: s => s.totalPts >= 1000 },
      { id: 'ten_k', name: 'Department Lead', icon: 'üèÖ', desc: 'Earn 10,000 total pts', check: s => s.totalPts >= 10000 },
      { id: 'hundred_k', name: 'District SSW', icon: 'üëë', desc: 'Earn 100,000 total pts', check: s => s.totalPts >= 100000 },
      { id: 'first_right', name: 'Quick Study', icon: 'üìñ', desc: 'Answer 1 question correctly', check: s => s.correct >= 1 },
      { id: 'ten_right', name: 'Study Group', icon: 'üìù', desc: 'Answer 10 questions correctly', check: s => s.correct >= 10 },
      { id: 'twenty_right', name: 'Exam Ready', icon: 'üéì', desc: 'Answer 25 questions correctly', check: s => s.correct >= 25 },
      { id: 'fifty_right', name: 'PEL Scholar', icon: 'üß†', desc: 'Answer 50 questions correctly', check: s => s.correct >= 50 },
      { id: 'streak5', name: 'On a Roll', icon: 'üî•', desc: 'Get 3 correct in a row', check: s => s.bestStreak >= 3 },
      { id: 'streak10', name: 'Unstoppable', icon: 'üí´', desc: 'Get 10 correct in a row', check: s => s.bestStreak >= 10 },
      { id: 'first_buy', name: 'First Upgrade', icon: 'üõí', desc: 'Buy your first upgrade', check: s => s.totalBuys >= 1 },
      { id: 'five_buys', name: 'Well Equipped', icon: 'üß∞', desc: 'Buy 5 upgrades', check: s => s.totalBuys >= 5 },
      { id: 'perfect10', name: 'Perfect 10', icon: 'üíØ', desc: 'Answer 10 in a row without a miss', check: s => s.bestStreak >= 10 },
      { id: 'master25', name: 'Quarter Master', icon: 'üìö', desc: 'Master 25% of flashcards', check: s => Object.keys(s.mastered).length >= Math.floor(flashcards.length * 0.25) },
      { id: 'master50', name: 'Half Way There', icon: 'üåü', desc: 'Master 50% of flashcards', check: s => Object.keys(s.mastered).length >= Math.floor(flashcards.length * 0.50) },
      { id: 'master75', name: 'Almost There', icon: 'üèÜ', desc: 'Master 75% of flashcards', check: s => Object.keys(s.mastered).length >= Math.floor(flashcards.length * 0.75) },
      { id: 'master100', name: 'PEL MASTER', icon: 'üéØ', desc: 'Master ALL flashcards!', check: s => Object.keys(s.mastered).length >= flashcards.length },
    ];

    // ========================================================
    // STATE
    // ========================================================
    const STREAK_MAX = 3;

    let state = {
      pts: 0,
      totalPts: 0,
      clickPower: 1,
      perSecond: 0,
      upgrades: {},
      achievements: {},
      correct: 0,
      wrong: 0,
      streak: 0,
      bestStreak: 0,
      tugStreak: 0,       // tug-of-war: -STREAK_MAX to +STREAK_MAX
      hotStreakMult: 2,    // base multiplier when hot
      coldDebuff: 0.5,    // multiplier when cold
      totalBuys: 0,
      prestigeLevel: 0,
      prestigeMultiplier: 1,
      questionStats: {},
      mastered: {},
    };

    // ========================================================
    // DOM
    // ========================================================
    const scoreEl = document.getElementById('score');
    const perSecEl = document.getElementById('perSecond');
    const clickBtn = document.getElementById('clickBtn');
    const clickPowerEl = document.getElementById('clickPower');
    const shopList = document.getElementById('shopList');
    const achGrid = document.getElementById('achGrid');
    const achCount = document.getElementById('achCount');
    const quizOverlay = document.getElementById('quizOverlay');
    const quizLabel = document.getElementById('quizLabel');
    const quizCost = document.getElementById('quizCost');
    const quizQuestion = document.getElementById('quizQuestion');
    const quizOptions = document.getElementById('quizOptions');
    const quizResult = document.getElementById('quizResult');
    const quizClose = document.getElementById('quizClose');
    const toastContainer = document.getElementById('toastContainer');
    const statCorrect = document.getElementById('statCorrect');
    const statAccuracy = document.getElementById('statAccuracy');
    const statMastered = document.getElementById('statMastered');
    const statTotal = document.getElementById('statTotal');
    const studyBarFill = document.getElementById('studyBarFill');
    const studyBarText = document.getElementById('studyBarText');

    statTotal.textContent = flashcards.length;

    // ========================================================
    // FORMAT
    // ========================================================
    function fmt(n) {
      if (n >= 1e9) return (n / 1e9).toFixed(1) + 'B';
      if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
      if (n >= 10000) return (n / 1e3).toFixed(1) + 'K';
      return Math.floor(n).toLocaleString();
    }

    // ========================================================
    // CLICK
    // ========================================================
    clickBtn.addEventListener('click', (e) => {
      const clickGain = Math.max(1, Math.floor(state.clickPower * state.prestigeMultiplier * getTugMultiplier()));
      state.pts += clickGain;
      state.totalPts += clickGain;

      clickBtn.classList.add('clicked');
      setTimeout(() => clickBtn.classList.remove('clicked'), 80);

      const txt = document.createElement('div');
      txt.className = 'click-text';
      txt.textContent = '+' + fmt(clickGain);
      txt.style.left = (e.clientX - 20) + 'px';
      txt.style.top = (e.clientY - 20) + 'px';
      document.body.appendChild(txt);
      setTimeout(() => txt.remove(), 900);

      updateUI();
      checkAchievements();
    });

    // ========================================================
    // SHOP
    // ========================================================
    let shopBuilt = false;
    let pendingUpgrade = null;

    function buildShop() {
      shopList.innerHTML = '';
      upgrades.forEach(u => {
        const div = document.createElement('div');
        div.className = 'shop-item locked';
        div.dataset.id = u.id;
        div.innerHTML = `
      <div class="icon">${u.icon}</div>
      <div class="info">
        <div class="name">${u.name}</div>
        <div class="desc">${u.desc}</div>
      </div>
      <div style="text-align:right">
        <div class="cost"></div>
        <div class="owned"></div>
      </div>
    `;
        div.addEventListener('click', () => tryBuy(u));
        shopList.appendChild(div);
      });
      shopBuilt = true;
    }

    function renderShop() {
      if (!shopBuilt) buildShop();
      upgrades.forEach(u => {
        const div = shopList.querySelector(`[data-id="${u.id}"]`);
        if (!div) return;
        const owned = state.upgrades[u.id] || 0;
        const cost = Math.floor(u.baseCost * Math.pow(1.15, owned));
        div.classList.toggle('locked', state.pts < cost);
        div.querySelector('.cost').textContent = fmt(cost);
        div.querySelector('.owned').textContent = owned > 0 ? 'x' + owned : '';
      });
    }

    function tryBuy(u) {
      const owned = state.upgrades[u.id] || 0;
      const cost = Math.floor(u.baseCost * Math.pow(1.15, owned));
      if (state.pts < cost) return;

      pendingUpgrade = { upgrade: u, cost };
      showQuiz(u.name, cost);
    }

    function completePurchase() {
      if (!pendingUpgrade) return;
      const { upgrade: u, cost } = pendingUpgrade;
      if (state.pts < cost) { pendingUpgrade = null; return; }

      state.pts -= cost;
      state.upgrades[u.id] = (state.upgrades[u.id] || 0) + 1;
      state.totalBuys++;

      if (u.cps) state.perSecond += u.cps;
      if (u.clickBonus) state.clickPower += u.clickBonus;
      if (u.streakBoost) state.hotStreakMult += u.streakBoost;

      pendingUpgrade = null;
      updateUI();
      checkAchievements();
      trySave();
    }

    // ========================================================
    // QUIZ
    // ========================================================
    function pickQuestion() {
      // Prioritize questions not yet mastered, weighted by fewer correct answers
      const unmastered = [];
      const masteredList = [];
      flashcards.forEach((fc, i) => {
        if (state.mastered[i]) {
          masteredList.push(i);
        } else {
          unmastered.push(i);
        }
      });

      const pool = unmastered.length > 0 ? unmastered : masteredList;
      // Weight toward less-seen questions
      const weights = pool.map(i => {
        const stats = state.questionStats[i];
        const seen = stats ? (stats.right + stats.wrong) : 0;
        return Math.max(1, 10 - seen);
      });
      const totalWeight = weights.reduce((a, b) => a + b, 0);
      let r = Math.random() * totalWeight;
      for (let i = 0; i < pool.length; i++) {
        r -= weights[i];
        if (r <= 0) return pool[i];
      }
      return pool[pool.length - 1];
    }

    function showQuiz(upgradeName, cost) {
      const qIndex = pickQuestion();
      const fc = flashcards[qIndex];

      quizLabel.textContent = `Answer to unlock: ${upgradeName}`;
      quizCost.textContent = fmt(cost) + ' pts';
      quizQuestion.textContent = fc.q;
      quizOptions.innerHTML = '';
      quizAnswered = false;
      quizResult.className = 'quiz-result';
      quizResult.style.display = 'none';
      quizClose.className = 'quiz-close';

      // Shuffle option order but track correct
      const indices = fc.options.map((_, i) => i);
      for (let i = indices.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [indices[i], indices[j]] = [indices[j], indices[i]];
      }

      indices.forEach(origIdx => {
        const btn = document.createElement('div');
        btn.className = 'quiz-option';
        btn.textContent = fc.options[origIdx];
        btn.addEventListener('click', () => handleAnswer(qIndex, origIdx, btn));
        quizOptions.appendChild(btn);
      });

      quizOverlay.classList.add('active');
    }

    let quizAnswered = false;

    function screenFlash(type) {
      const flash = document.createElement('div');
      flash.className = 'screen-flash ' + type;
      document.body.appendChild(flash);
      setTimeout(() => flash.remove(), 700);
    }

    function showMasteryCelebration() {
      screenFlash('green');
      const popup = document.createElement('div');
      popup.className = 'mastery-popup';
      popup.innerHTML = '<span class="mastery-icon">üéØ</span><span class="mastery-text">MASTERED!</span>';
      document.body.appendChild(popup);
      setTimeout(() => popup.remove(), 1600);

      // Sparkles
      const sparkles = ['‚≠ê', '‚ú®', 'üåü', 'üí´', '‚≠ê', '‚ú®'];
      sparkles.forEach((s, i) => {
        const el = document.createElement('div');
        el.className = 'mastery-sparkle';
        el.textContent = s;
        const angle = (i / sparkles.length) * Math.PI * 2;
        const dist = 80 + Math.random() * 60;
        el.style.left = (window.innerWidth / 2 + Math.cos(angle) * dist) + 'px';
        el.style.top = (window.innerHeight / 2 + Math.sin(angle) * dist) + 'px';
        el.style.animationDelay = (i * 0.08) + 's';
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 1200);
      });
    }

    function quizFloatNumber(text, type) {
      const el = document.createElement('div');
      el.className = 'quiz-float-number ' + type;
      el.textContent = text;
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 1300);
    }

    function handleAnswer(qIndex, chosenIdx, btnEl) {
      if (quizAnswered) return;
      quizAnswered = true;

      const fc = flashcards[qIndex];
      const isCorrect = chosenIdx === fc.answer;

      // Disable all options
      const allOpts = quizOptions.querySelectorAll('.quiz-option');
      allOpts.forEach(opt => {
        opt.classList.add('disabled');
        if (opt.textContent === fc.options[fc.answer]) {
          opt.classList.add('correct');
        }
      });

      if (!isCorrect) {
        btnEl.classList.add('wrong');
      }

      // Update stats
      if (!state.questionStats[qIndex]) state.questionStats[qIndex] = { right: 0, wrong: 0, consecutiveRight: 0 };
      if (state.questionStats[qIndex].consecutiveRight === undefined) state.questionStats[qIndex].consecutiveRight = 0;

      if (isCorrect) {
        state.correct++;
        state.streak++;
        if (state.streak > state.bestStreak) state.bestStreak = state.streak;
        state.tugStreak = Math.min(STREAK_MAX, state.tugStreak + 1);
        state.questionStats[qIndex].right++;
        state.questionStats[qIndex].consecutiveRight++;

        // Master after 3 correct IN A ROW
        if (state.questionStats[qIndex].consecutiveRight >= 3 && !state.mastered[qIndex]) {
          state.mastered[qIndex] = true;
          showToast('üéØ', 'Question Mastered!', '3 correct in a row!');
          showMasteryCelebration();
        }

        let streakMsg = '';
        if (state.tugStreak >= STREAK_MAX) {
          streakMsg = `<br>üî• HOT STREAK! ${state.hotStreakMult}x generation!`;
        } else if (state.tugStreak > 0) {
          streakMsg = ` (${state.tugStreak}/${STREAK_MAX} toward Hot Streak)`;
        }

        quizResult.className = 'quiz-result correct-result';
        quizResult.innerHTML = `‚úÖ Correct! Upgrade purchased!${streakMsg}`;
        quizResult.style.display = 'block';
        quizClose.textContent = 'Continue';
        screenFlash('green');
        const pu = pendingUpgrade ? pendingUpgrade.upgrade : null;
        let floatText = 'Upgrade!';
        if (pu) {
          if (pu.cps) floatText = '+' + pu.cps + ' PEL bux/sec';
          else if (pu.clickBonus) floatText = '+' + pu.clickBonus + ' click power';
          else if (pu.streakBoost) floatText = '+' + pu.streakBoost + 'x streak boost';
        }
        quizFloatNumber(floatText, 'reward');
        completePurchase();
      } else {
        state.wrong++;
        state.streak = 0;
        state.tugStreak = Math.max(-STREAK_MAX, state.tugStreak - 1);
        state.questionStats[qIndex].wrong++;
        state.questionStats[qIndex].consecutiveRight = 0;

        // Lose the full cost of the upgrade you were trying to buy
        const penalty = pendingUpgrade ? pendingUpgrade.cost : 0;
        state.pts -= penalty;
        if (state.pts < 0) state.pts = 0;

        let coldMsg = '';
        if (state.tugStreak <= -STREAK_MAX) {
          coldMsg = `<br>ü•∂ COLD STREAK! Generation halved!<br><a href="#" class="quiz-study-link" style="color:#4ecdc4;font-weight:700;">Study PEL Flashcards ‚Üí</a>`;
        } else if (state.tugStreak < 0) {
          coldMsg = `<br>Streak: ${state.tugStreak}/‚àí${STREAK_MAX} toward Cold Streak...`;
        }

        quizResult.className = 'quiz-result wrong-result';
        quizResult.innerHTML = `‚ùå Not quite! You lost ${fmt(penalty)} pts.${coldMsg}<br>The correct answer is highlighted above.`;
        quizResult.style.display = 'block';
        quizClose.textContent = 'Close (No Purchase)';
        screenFlash('red');
        quizFloatNumber('‚àí' + fmt(penalty), 'penalty');
        pendingUpgrade = null;
      }

      updateTugBar();

      quizClose.classList.add('show');

      // Wire up study link in quiz result if present
      setTimeout(() => {
        const studyLink = quizResult.querySelector('.quiz-study-link');
        if (studyLink) studyLink.addEventListener('click', (e) => {
          e.preventDefault();
          quizOverlay.classList.remove('active');
          renderReview();
          reviewOverlay.classList.add('active');
        });
      }, 0);

      updateStudyStats();
      checkAchievements();
      trySave();
    }

    quizClose.addEventListener('click', () => {
      quizOverlay.classList.remove('active');
    });

    // Close on overlay click (outside modal)
    quizOverlay.addEventListener('click', (e) => {
      if (e.target === quizOverlay) {
        quizOverlay.classList.remove('active');
        pendingUpgrade = null;
      }
    });

    // ========================================================
    // STUDY STATS
    // ========================================================
    function updateStudyStats() {
      const total = state.correct + state.wrong;
      statCorrect.textContent = state.correct;
      statAccuracy.textContent = total > 0 ? Math.round((state.correct / total) * 100) + '%' : '--%';
      const masteredCount = Object.keys(state.mastered).length;
      statMastered.textContent = masteredCount;
      const pct = Math.round((masteredCount / flashcards.length) * 100);
      studyBarFill.style.width = pct + '%';
      studyBarText.textContent = pct + '% Mastered';
    }

    // ========================================================
    // ACHIEVEMENTS
    // ========================================================
    function renderAchievements() {
      achGrid.innerHTML = '';
      let count = 0;
      achievements.forEach(a => {
        const unlocked = state.achievements[a.id];
        if (unlocked) count++;
        const div = document.createElement('div');
        div.className = 'ach-card ' + (unlocked ? 'unlocked' : 'locked');
        div.id = 'ach-' + a.id;
        div.innerHTML = `
      <div class="ach-icon">${a.icon}</div>
      <div class="ach-name">${unlocked ? a.name : '???'}</div>
      <div class="ach-desc">${unlocked ? a.desc : 'Keep going...'}</div>
    `;
        achGrid.appendChild(div);
      });
      achCount.textContent = `(${count}/${achievements.length})`;
    }

    function checkAchievements() {
      achievements.forEach(a => {
        if (!state.achievements[a.id] && a.check(state)) {
          state.achievements[a.id] = true;
          showToast(a.icon, a.name, a.desc);
          setTimeout(() => {
            const el = document.getElementById('ach-' + a.id);
            if (el) {
              el.classList.remove('locked');
              el.classList.add('unlocked', 'just-unlocked');
              el.querySelector('.ach-name').textContent = a.name;
              el.querySelector('.ach-desc').textContent = a.desc;
            }
          }, 100);
          const count = Object.keys(state.achievements).length;
          achCount.textContent = `(${count}/${achievements.length})`;
        }
      });
    }

    // ========================================================
    // TOAST
    // ========================================================
    function showToast(icon, title, desc) {
      const t = document.createElement('div');
      t.className = 'toast';
      t.innerHTML = `<div class="toast-icon">${icon}</div><div class="toast-text"><strong>${title}</strong><br>${desc}</div>`;
      toastContainer.appendChild(t);
      setTimeout(() => t.remove(), 3500);
    }

    // ========================================================
    // GAME LOOP
    // ========================================================
    // ========================================================
    // PRESTIGE
    // ========================================================
    const PRESTIGE_COST = 500000;
    const prestigeBtn = document.getElementById('prestigeBtn');
    const prestigeDesc = document.getElementById('prestigeDesc');
    const prestigeFill = document.getElementById('prestigeFill');
    const prestigeProgressText = document.getElementById('prestigeProgressText');
    const prestigeMult = document.getElementById('prestigeMult');
    const yearBadge = document.getElementById('yearBadge');

    let currentSeason = null;
    let summerAnimating = false;

    // Season color palettes: three gradient stops [r,g,b] each
    const seasonColors = {
      fall: { a: [26, 15, 0], b: [45, 24, 16], c: [61, 36, 21] },
      winter: { a: [10, 22, 40], b: [26, 42, 74], c: [42, 58, 90] },
      spring: { a: [10, 26, 16], b: [26, 48, 40], c: [31, 64, 48] },
      summer: { a: [80, 55, 10], b: [130, 90, 15], c: [160, 120, 25] },
    };

    const defaultBodyColors = { a: [12, 24, 33], b: [22, 36, 71], c: [31, 64, 104] };

    // Season thresholds (fraction of PRESTIGE_COST)
    const seasonThresholds = [
      { season: 'fall', start: 0.00, end: 0.30 },
      { season: 'winter', start: 0.30, end: 0.60 },
      { season: 'spring', start: 0.60, end: 1.00 },
    ];

    function lerpColor(c1, c2, t) {
      return [
        Math.round(c1[0] + (c2[0] - c1[0]) * t),
        Math.round(c1[1] + (c2[1] - c1[1]) * t),
        Math.round(c1[2] + (c2[2] - c1[2]) * t),
      ];
    }

    function rgbStr(c) { return `rgb(${c[0]},${c[1]},${c[2]})`; }

    function getBlendedBackground() {
      const pct = Math.min(state.totalPts / PRESTIGE_COST, 1.0);

      // Color stops: continuous ramp through all seasons
      // At each threshold pct you get the pure season color;
      // between thresholds the colors interpolate smoothly.
      const stops = [
        { at: 0.00, colors: seasonColors.fall },
        { at: 0.30, colors: seasonColors.winter },
        { at: 0.60, colors: seasonColors.spring },
        { at: 1.00, colors: seasonColors.summer },
      ];

      // Find which two stops we're between
      let from = stops[0], to = stops[stops.length - 1];
      for (let i = 0; i < stops.length - 1; i++) {
        if (pct >= stops[i].at && pct <= stops[i + 1].at) {
          from = stops[i];
          to = stops[i + 1];
          break;
        }
      }

      const range = to.at - from.at;
      const t = range > 0 ? (pct - from.at) / range : 0; // 0‚Üí1 between the two stops
      const a = lerpColor(from.colors.a, to.colors.a, t);
      const b = lerpColor(from.colors.b, to.colors.b, t);
      const c = lerpColor(from.colors.c, to.colors.c, t);
      return `linear-gradient(135deg, ${rgbStr(a)} 0%, ${rgbStr(b)} 50%, ${rgbStr(c)} 100%)`;
    }

    function getSeason() {
      const pct = state.totalPts / PRESTIGE_COST;
      if (pct < 0.30) return 'fall';   // 0‚Äì150K
      if (pct < 0.60) return 'winter'; // 150K‚Äì300K
      if (pct < 0.80) return 'spring'; // 300K‚Äì400K
      return 'spring'; // 400K‚Äì500K: late spring, particles hint at summer
    }

    const seasonMeta = {
      fall: { emoji: 'üçÇ', label: 'Fall' },
      winter: { emoji: '‚ùÑÔ∏è', label: 'Winter' },
      spring: { emoji: 'üå∏', label: 'Spring' },
      summer: { emoji: '‚òÄÔ∏è', label: 'Summer' },
    };

    function spawnBurstParticle(emoji) {
      const p = document.createElement('div');
      p.className = 'burst-particle';
      p.textContent = emoji;
      const angle = Math.random() * Math.PI * 2;
      const dist = 60 + Math.random() * 120;
      p.style.left = '50vw';
      p.style.top = '45vh';
      p.style.setProperty('--bx', Math.cos(angle) * dist + 'px');
      p.style.setProperty('--by', Math.sin(angle) * dist + 'px');
      p.style.animationDuration = (1.2 + Math.random() * 0.8) + 's';
      document.body.appendChild(p);
      setTimeout(() => p.remove(), 2200);
    }

    function showSeasonBanner(season) {
      const meta = seasonMeta[season];
      const banner = document.createElement('div');
      banner.className = 'season-banner';
      banner.innerHTML = `<div class="season-banner-inner">
    <span class="season-banner-emoji">${meta.emoji}</span>
    <span class="season-banner-text">${meta.label}</span>
  </div>`;
      document.body.appendChild(banner);
      setTimeout(() => banner.remove(), 2600);
      // Burst of visible particles from center
      const emojis = seasonEmojis[season];
      for (let i = 0; i < 14; i++) {
        setTimeout(() => spawnBurstParticle(emojis[Math.floor(Math.random() * emojis.length)]), i * 50);
      }
    }

    function applySeason(season) {
      if (summerAnimating) return; // don't override during prestige animation
      const isFirstLoad = currentSeason === null;
      if (season === currentSeason) return;
      currentSeason = season;
      document.body.classList.remove('season-fall', 'season-winter', 'season-spring', 'season-summer');
      document.body.classList.add('season-' + season);
      document.body.style.background = getBlendedBackground();
      startAmbient(season);
      if (!isFirstLoad) showSeasonBanner(season);
    }

    function getYear() {
      return state.prestigeLevel + 1;
    }

    function updatePrestige() {
      const pct = Math.min(100, (state.totalPts / PRESTIGE_COST) * 100);
      prestigeFill.style.width = pct + '%';

      // Update blended background every tick for smooth transitions
      if (!summerAnimating) {
        document.body.style.background = getBlendedBackground();
      }

      applySeason(getSeason());

      const year = getYear();
      const seasonLabels = { fall: 'üçÇ Fall', winter: '‚ùÑÔ∏è Winter', spring: 'üå∏ Spring', summer: '‚òÄÔ∏è Summer' };
      const season = currentSeason || 'fall';
      yearBadge.textContent = `Year ${year} ‚Äî ${seasonLabels[season]}`;

      const nextSeasonNames = { fall: '150K ‚Üí Winter ‚ùÑÔ∏è', winter: '300K ‚Üí Spring üå∏', spring: '500K ‚Üí Summer ‚òÄÔ∏è' };
      if (state.totalPts >= PRESTIGE_COST) {
        prestigeProgressText.textContent = fmt(state.totalPts) + ' / 500K ‚òÄÔ∏è';
      } else {
        prestigeProgressText.textContent = fmt(state.totalPts) + ' / ' + (nextSeasonNames[season] || '500K ‚Üí Summer ‚òÄÔ∏è');
      }

      prestigeBtn.disabled = state.totalPts < PRESTIGE_COST;

      if (state.totalPts >= PRESTIGE_COST) {
        const nextMult = ((state.prestigeLevel + 1) * 0.5 + 1).toFixed(1);
        prestigeDesc.textContent = `Start Year ${year + 1} with a ${nextMult}x multiplier!`;
      } else {
        const seasonDescs = {
          fall: 'Fall ‚Äî earn your way through to Winter!',
          winter: 'Winter ‚Äî keep pushing toward Spring!',
          spring: 'Spring ‚Äî Summer Vacation is in sight!',
        };
        prestigeDesc.textContent = seasonDescs[season] || 'Keep going to reach Summer Vacation!';
      }

      if (state.prestigeLevel > 0) {
        prestigeMult.textContent = `üìà ${state.prestigeMultiplier}x Experience Bonus`;
      } else {
        prestigeMult.textContent = '';
      }
    }

    function summerBurst() {
      const emojis = seasonEmojis.summer;
      for (let i = 0; i < 16; i++) {
        setTimeout(() => spawnBurstParticle(emojis[Math.floor(Math.random() * emojis.length)]), i * 60);
      }
    }

    prestigeBtn.addEventListener('click', () => {
      if (state.totalPts < PRESTIGE_COST) return;
      if (!confirm('Go on Summer Vacation? You will reset PEL bux, upgrades, and achievements ‚Äî but keep your study progress and come back with a stronger multiplier!')) return;

      // Flash summer theme + burst particles
      summerAnimating = true;
      currentSeason = 'summer';
      document.body.classList.remove('season-fall', 'season-winter', 'season-spring');
      document.body.classList.add('season-summer');
      document.body.style.background = getBlendedBackground();
      startAmbient('summer'); // clears ambient effects
      showSeasonBanner('summer');
      summerBurst();
      prestigeBtn.disabled = true;

      setTimeout(() => {
        state.prestigeLevel++;
        state.prestigeMultiplier = state.prestigeLevel * 0.5 + 1;

        // Reset game progress
        state.pts = 0;
        state.totalPts = 0;
        state.clickPower = 1;
        state.perSecond = 0;
        state.upgrades = {};
        state.achievements = {};
        state.totalBuys = 0;
        state.streak = 0;
        state.bestStreak = 0;
        state.tugStreak = 0;
        state.hotStreakMult = 2;   // reset to base (upgrades are wiped)
        state.coldDebuff = 0.5;   // reset to base
        // Keep: correct, wrong, questionStats, mastered, prestigeLevel, prestigeMultiplier

        shopBuilt = false;

        // Animate transition from summer to fall over 2.5s
        currentSeason = 'fall';
        document.body.classList.remove('season-summer');
        document.body.classList.add('season-fall');
        startAmbient('fall');
        showSeasonBanner('fall');

        const summerC = seasonColors.summer;
        const fallC = seasonColors.fall;
        const transitionDuration = 2500;
        const startTime = performance.now();
        function animateToFall(now) {
          const elapsed = now - startTime;
          const t = Math.min(elapsed / transitionDuration, 1);
          // Ease-out for a natural feel
          const ease = 1 - Math.pow(1 - t, 3);
          const a = lerpColor(summerC.a, fallC.a, ease);
          const b = lerpColor(summerC.b, fallC.b, ease);
          const c = lerpColor(summerC.c, fallC.c, ease);
          document.body.style.background = `linear-gradient(135deg, ${rgbStr(a)} 0%, ${rgbStr(b)} 50%, ${rgbStr(c)} 100%)`;
          if (t < 1) {
            requestAnimationFrame(animateToFall);
          } else {
            summerAnimating = false;
          }
        }
        requestAnimationFrame(animateToFall);

        renderAchievements();
        updateTugBar();
        updateUI();
        showToast('‚òÄÔ∏è', 'Summer Vacation!', `Welcome back! ${state.prestigeMultiplier}x multiplier active.`);
        trySave();
      }, 2000);
    });

    // ========================================================
    // TUG-OF-WAR
    // ========================================================
    const tugPuck = document.getElementById('tugPuck');
    const tugPuckIcon = document.getElementById('tugPuckIcon');
    const tugFillCold = document.getElementById('tugFillCold');
    const tugFillHot = document.getElementById('tugFillHot');
    const tugStatus = document.getElementById('tugStatus');
    const tugColdEnd = document.querySelector('.cold-end');
    const tugHotEnd = document.querySelector('.hot-end');

    function updateTugBar() {
      // Fill bars grow from center (50%). Puck sits at the leading edge.
      let coldWidth = 0;
      let hotWidth = 0;
      let puckPct = 50; // center

      if (state.tugStreak < 0) {
        coldWidth = (Math.abs(state.tugStreak) / STREAK_MAX) * 50;
        puckPct = 50 - coldWidth;
      } else if (state.tugStreak > 0) {
        hotWidth = (state.tugStreak / STREAK_MAX) * 50;
        puckPct = 50 + hotWidth;
      }

      tugFillCold.style.width = coldWidth + '%';
      tugFillHot.style.width = hotWidth + '%';
      tugPuck.style.left = puckPct + '%';

      // Reset states
      tugPuck.classList.remove('hot', 'cold', 'hidden');
      tugFillCold.classList.remove('maxed');
      tugFillHot.classList.remove('maxed');
      tugColdEnd.classList.remove('active');
      tugHotEnd.classList.remove('active');
      clickBtn.classList.remove('hot-streak', 'cold-streak');
      perSecEl.classList.remove('hot-pps', 'cold-pps');
      clickPowerEl.classList.remove('hot-cpd', 'cold-cpd');

      if (state.tugStreak >= STREAK_MAX) {
        tugPuck.classList.add('hidden');
        tugFillHot.classList.add('maxed');
        tugHotEnd.classList.add('active');
        clickBtn.classList.add('hot-streak');
        perSecEl.classList.add('hot-pps');
        clickPowerEl.classList.add('hot-cpd');
        tugStatus.className = 'tug-status-bar hot';
        tugStatus.innerHTML = `üî• HOT STREAK ‚Äî ${state.hotStreakMult}x Generation!`;
      } else if (state.tugStreak <= -STREAK_MAX) {
        tugPuck.classList.add('hidden');
        tugFillCold.classList.add('maxed');
        tugColdEnd.classList.add('active');
        clickBtn.classList.add('cold-streak');
        perSecEl.classList.add('cold-pps');
        clickPowerEl.classList.add('cold-cpd');
        tugStatus.className = 'tug-status-bar cold';
        tugStatus.innerHTML = `ü•∂ COLD STREAK ‚Äî 0.5x Generation! <a class="tug-study-link" href="#" id="tugStudyLink">Study PEL Flashcards ‚Üí</a>`;
        setTimeout(() => {
          const link = document.getElementById('tugStudyLink');
          if (link) link.addEventListener('click', (e) => {
            e.preventDefault();
            renderReview();
            reviewOverlay.classList.add('active');
          });
        }, 0);
      } else {
        tugPuckIcon.textContent = '‚öñÔ∏è';
        tugStatus.className = 'tug-status-bar neutral';
        if (state.tugStreak > 0) {
          tugStatus.textContent = `${STREAK_MAX - state.tugStreak} more correct to Hot Streak`;
        } else if (state.tugStreak < 0) {
          tugStatus.textContent = `${STREAK_MAX + state.tugStreak} more wrong to Cold Streak`;
        } else {
          tugStatus.textContent = '';
        }
      }
    }

    function getTugMultiplier() {
      if (state.tugStreak >= STREAK_MAX) return state.hotStreakMult;
      if (state.tugStreak <= -STREAK_MAX) return state.coldDebuff;
      return 1;
    }

    function getEffectivePerSecond() {
      return state.perSecond * getTugMultiplier() * state.prestigeMultiplier;
    }

    function updateUI() {
      const mult = getTugMultiplier();
      const effectivePPS = getEffectivePerSecond();
      scoreEl.textContent = fmt(state.pts);

      const ppsDisplay = effectivePPS > 0 && effectivePPS < 1
        ? effectivePPS.toFixed(1)
        : fmt(effectivePPS);
      let ppsText = ppsDisplay + ' pts/sec';
      if (state.tugStreak >= STREAK_MAX) ppsText += ' üî•' + state.hotStreakMult + 'x';
      else if (state.tugStreak <= -STREAK_MAX) ppsText += ' ü•∂ 0.5x';
      perSecEl.textContent = ppsText;

      const effectiveClick = Math.max(1, Math.floor(state.clickPower * state.prestigeMultiplier * getTugMultiplier()));
      clickPowerEl.textContent = '+' + fmt(effectiveClick) + ' per click';
      renderShop();
      updateTugBar();
      updatePrestige();
    }


    function gameTick() {
      if (state.perSecond > 0) {
        const gain = getEffectivePerSecond() / 20;
        state.pts += gain;
        state.totalPts += gain;
      }


      updateUI();
      checkAchievements();
    }

    // ========================================================
    // SAVE / LOAD
    // ========================================================
    function trySave() {
      try { localStorage.setItem('pelclicker', JSON.stringify(state)); } catch (e) { }
    }

    function tryLoad() {
      try {
        const saved = localStorage.getItem('pelclicker');
        if (saved) Object.assign(state, JSON.parse(saved));
      } catch (e) { }
    }

    // ========================================================
    // RESET
    // ========================================================
    document.getElementById('resetBtn').addEventListener('click', () => {
      if (!confirm('Reset all progress? This will erase your score, upgrades, achievements, and study stats.')) return;
      localStorage.removeItem('pelclicker');
      location.reload();
    });

    // ========================================================
    // REVIEW PANEL
    // ========================================================
    const reviewBtn = document.getElementById('reviewBtn');
    const reviewOverlay = document.getElementById('reviewOverlay');
    const reviewCloseBtn = document.getElementById('reviewCloseBtn');
    const reviewList = document.getElementById('reviewList');
    const reviewFilters = document.getElementById('reviewFilters');
    let currentFilter = 'all';

    reviewBtn.addEventListener('click', () => {
      renderReview();
      reviewOverlay.classList.add('active');
    });

    reviewCloseBtn.addEventListener('click', () => {
      reviewOverlay.classList.remove('active');
    });

    reviewOverlay.addEventListener('click', (e) => {
      if (e.target === reviewOverlay) reviewOverlay.classList.remove('active');
    });

    reviewFilters.addEventListener('click', (e) => {
      const btn = e.target.closest('.filter-btn');
      if (!btn) return;
      reviewFilters.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentFilter = btn.dataset.filter;
      renderReview();
    });

    function getQuestionStatus(i) {
      const stats = state.questionStats[i];
      if (state.mastered[i]) return 'mastered';
      if (!stats) return 'unseen';
      if (stats.wrong > stats.right) return 'wrong';
      if (stats.right > 0) return 'correct';
      return 'unseen';
    }

    function renderReview() {
      reviewList.innerHTML = '';
      let shown = 0;

      flashcards.forEach((fc, i) => {
        const status = getQuestionStatus(i);
        if (currentFilter !== 'all' && currentFilter !== status) return;

        shown++;
        const stats = state.questionStats[i] || { right: 0, wrong: 0 };
        let badgeClass, badgeText;
        if (status === 'mastered') { badgeClass = 'badge-mastered'; badgeText = 'Mastered'; }
        else if (status === 'correct') { badgeClass = 'badge-learning'; badgeText = 'Learning'; }
        else if (status === 'wrong') { badgeClass = 'badge-struggling'; badgeText = 'Needs Work'; }
        else { badgeClass = 'badge-unseen'; badgeText = 'Not Seen'; }

        const card = document.createElement('div');
        card.className = `review-card status-${status}`;
        card.innerHTML = `
      <div class="rc-question">${fc.q}</div>
      <div class="rc-answer">Answer: ${fc.options[fc.answer]}</div>
      <div class="rc-stats">
        <span class="rc-right">Correct: ${stats.right}</span>
        <span class="rc-wrong">Wrong: ${stats.wrong}</span>
        <span class="rc-badge ${badgeClass}">${badgeText}</span>
      </div>
    `;
        reviewList.appendChild(card);
      });

      if (shown === 0) {
        reviewList.innerHTML = '<div class="review-empty">No questions match this filter yet. Keep playing!</div>';
      }
    }

    // ========================================================
    // PARTICLES
    // ========================================================
    const seasonEmojis = {
      fall: ['üçÇ', 'üçÅ', 'üéÉ', 'üèà', 'üìì', '‚úèÔ∏è', 'üìã', 'üè´', 'üìù', 'üß†'],
      winter: ['‚ùÑÔ∏è', '‚õÑ', 'üß£', 'üéÑ', '‚òï', 'üìö', 'üìñ', 'üß†', 'üßò', 'ü™ë'],
      spring: ['üå∏', 'üå∑', 'üå±', 'üêù', 'üåà', '‚òÄÔ∏è', 'üìã', 'üìù', 'üß†', 'üìö'],
      summer: ['üèñÔ∏è', 'üåä', 'üòé', 'üç¶', '‚òÄÔ∏è', 'üå¥', 'üéâ', 'üèÑ', 'üêö', 'üå∫'],
    };

    function spawnParticle(forceEmojis) {
      let emojis = forceEmojis || seasonEmojis[currentSeason] || seasonEmojis.fall;
      // Late spring (80%+): mix in some summer emojis as a hint
      if (!forceEmojis && currentSeason === 'spring' && state.totalPts / PRESTIGE_COST >= 0.80) {
        emojis = [...seasonEmojis.spring, ...seasonEmojis.summer.slice(0, 4)];
      }
      const p = document.createElement('div');
      p.textContent = emojis[Math.floor(Math.random() * emojis.length)];
      p.style.cssText = `
    position: fixed;
    font-size: ${12 + Math.random() * 14}px;
    left: ${Math.random() * 100}vw;
    top: 100vh;
    opacity: 0.1;
    pointer-events: none;
    z-index: 0;
    animation: particleDrift ${10 + Math.random() * 15}s linear forwards;
  `;
      document.getElementById('particles').appendChild(p);
      setTimeout(() => p.remove(), 25000);
    }

    // ========================================================
    // AMBIENT SEASON EFFECTS
    // ========================================================
    let ambientInterval = null;

    function spawnSnowflake() {
      const flakes = ['‚ùÑ', '‚ùÖ', '‚ùÜ', '‚Ä¢', '‚àó'];
      const p = document.createElement('div');
      p.className = 'ambient ambient-snow';
      p.textContent = flakes[Math.floor(Math.random() * flakes.length)];
      const drift = (Math.random() - 0.5) * 120;
      const dur = 6 + Math.random() * 8;
      p.style.left = Math.random() * 100 + 'vw';
      p.style.setProperty('--drift', drift + 'px');
      p.style.fontSize = (10 + Math.random() * 10) + 'px';
      p.style.animationDuration = dur + 's';
      document.getElementById('particles').appendChild(p);
      setTimeout(() => p.remove(), dur * 1000 + 100);
    }

    function spawnLeaf() {
      const leaves = ['üçÇ', 'üçÅ', 'üçÉ'];
      const p = document.createElement('div');
      p.className = 'ambient ambient-leaf';
      p.textContent = leaves[Math.floor(Math.random() * leaves.length)];
      const drift = (Math.random() - 0.5) * 200;
      const dur = 7 + Math.random() * 8;
      p.style.left = Math.random() * 100 + 'vw';
      p.style.setProperty('--drift', drift + 'px');
      p.style.fontSize = (14 + Math.random() * 10) + 'px';
      p.style.animationDuration = dur + 's';
      document.getElementById('particles').appendChild(p);
      setTimeout(() => p.remove(), dur * 1000 + 100);
    }

    function spawnBird() {
      const birds = ['üê¶', 'üê¶‚Äç‚¨õ', 'üïäÔ∏è'];
      const p = document.createElement('div');
      p.className = 'ambient ambient-bird';
      p.textContent = birds[Math.floor(Math.random() * birds.length)];
      const fromLeft = Math.random() > 0.5;
      const dur = 8 + Math.random() * 6;
      const flyX = (40 + Math.random() * 60) * (fromLeft ? 1 : -1);
      const dip = (Math.random() - 0.5) * 80;
      const endY = (Math.random() - 0.5) * 40;
      p.style.left = fromLeft ? '-5vw' : '105vw';
      p.style.top = (5 + Math.random() * 40) + 'vh';
      p.style.setProperty('--fly-x', flyX + 'vw');
      p.style.setProperty('--fly-dip', dip + 'px');
      p.style.setProperty('--fly-end', endY + 'px');
      p.style.animationDuration = dur + 's';
      if (!fromLeft) p.style.transform = 'scaleX(-1)';
      document.getElementById('particles').appendChild(p);
      setTimeout(() => p.remove(), dur * 1000 + 100);
    }

    function startAmbient(season) {
      if (ambientInterval) clearInterval(ambientInterval);
      ambientInterval = null;
      if (season === 'winter') {
        ambientInterval = setInterval(spawnSnowflake, 400);
      } else if (season === 'fall') {
        ambientInterval = setInterval(spawnLeaf, 900);
      } else if (season === 'spring') {
        ambientInterval = setInterval(spawnBird, 3000);
      }
    }

    // ========================================================
    // INIT
    // ========================================================
    tryLoad();
    renderAchievements();
    updateStudyStats();
    updateTugBar();
    updateUI();

    setInterval(gameTick, 50);
    setInterval(trySave, 10000);
    setInterval(spawnParticle, 2500);
    for (let i = 0; i < 4; i++) setTimeout(spawnParticle, i * 500);
  </script>
</body>

</html>